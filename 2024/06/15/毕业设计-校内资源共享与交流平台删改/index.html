<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="毕业设计-校内资源共享与交流平台(删改), 小小舒的爪哇天地">
    <meta name="description" content="博主本科毕业设计完成于2023年大四，因为想把它作为博文分享到自己的个人博客所以在一年后，对论文做了一些删减（如论文的格式）。现在回国头来觉得写的很烂，不过也拿了90分，博主现在不打算再做Java方向了，辞职考研去了，现在就分享出来，毕业设">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>毕业设计-校内资源共享与交流平台(删改) | 小小舒的爪哇天地</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">小小舒的爪哇天地</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">小小舒的爪哇天地</div>
        <div class="logo-desc">
            
            Life is coding, I will debug it.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">毕业设计-校内资源共享与交流平台(删改)</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java/">
                                <span class="chip bg-color">Java</span>
                            </a>
                        
                            <a href="/tags/%E7%AE%97%E6%B3%95/">
                                <span class="chip bg-color">算法</span>
                            </a>
                        
                            <a href="/tags/redis/">
                                <span class="chip bg-color">redis</span>
                            </a>
                        
                            <a href="/tags/%E6%AF%95%E4%B8%9A%E8%AE%BA%E6%96%87/">
                                <span class="chip bg-color">毕业论文</span>
                            </a>
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                            <a href="/tags/Spring-Boot/">
                                <span class="chip bg-color">Spring Boot</span>
                            </a>
                        
                            <a href="/tags/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/">
                                <span class="chip bg-color">毕业设计</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                学习笔记
                            </a>
                        
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/" class="post-category">
                                个人项目
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2024-06-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2025-01-29
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    16.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    64 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>博主本科毕业设计完成于2023年大四，因为想把它作为博文分享到自己的个人博客所以在一年后，对论文做了一些删减（如论文的格式）。现在回国头来觉得写的很烂，不过也拿了90分，博主现在不打算再做Java方向了，辞职考研去了，现在就分享出来，毕业设计论文用Java的可以来找找灵感。论文转md可能会有一些错误、乱码等问题没有发现，可以留言。</p>
<h1 id="本科毕业论文（设计）"><a href="#本科毕业论文（设计）" class="headerlink" title="本科毕业论文（设计）"></a><strong>本科毕业论文（设计）</strong></h1><h1 id="校内资源共享与交流平台的设计与实现"><a href="#校内资源共享与交流平台的设计与实现" class="headerlink" title="校内资源共享与交流平台的设计与实现"></a><strong>校内资源共享与交流平台的设计与实现</strong></h1><hr>
<h1 id="摘-要"><a href="#摘-要" class="headerlink" title="摘 要"></a><strong>摘 要</strong></h1><p>近年来，随着互联网行业、技术的迅速发展，以及移动互联网的普及，高校学生在网络上的社交不断加深，从互联网中学习和获取知识信息也变得越来越普遍。由于互联网上的学习资源质量参差不起以及同学之间、师生之间存在信息交流闭塞的问题，导致学生很难获得合适的学习资源和交流环境。针对上述情况，设计开发一款集成校内社区交流功能与知识资源分享平台，为学生良好的社区交流环境，鼓励同学之间互帮互助，分享学习资源，降低资源搜集的成本。</p>
<p>该平台在技术上采用前后端分离架构，后端采用Java语言、基于Spring Boot框架开发、MyBatis作为持久层、Spring Security作为安全框架和MySQL数据库开发，并结合Redis缓存、RabbitMQ消息中间件、ElasticSearch搜索引擎等分布式中间件提高系统可靠性，前端基于Vue 3.0和Ant Design Vue组件库开发，实现社区、资源库、个人中心等功能。</p>
<p><strong>[关键词]：</strong>高校校园论坛；资源共享；Java；Spring Boot；Vue；</p>
<h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>In recent years, with the rapid development of Internet industry and technology, and the popularity of mobile Internet, college students have deepened their social interaction on the network, and learning and obtaining knowledge and information from the Internet has become more and more common. Due to the uneven quality of learning resources on the Internet and the blocked information exchange between students and teachers and students, it is difficult for students to obtain suitable learning resources and communication environment. In view of the above situation, an integrated community communication function and knowledge resource sharing platform is designed and developed to provide students with a good community communication environment, encourage students to help each other, share learning resources, and reduce the cost of resource collection.</p>
<p>The back-end uses Java language, based on Spring Boot framework development, MyBatis as the persistence layer, Spring Security as the security framework and MySQL database development. Redis cache, RabbitMQ message middleware, ElasticSearch search engine and other distributed middleware are combined to improve the reliability of the system. The front-end is developed based on Vue 3.0 and Ant Design Vue component library to realize the functions of community, resource library, personal center and so on.</p>
<p><strong>[Key words]:</strong> College Campus Forum; Resource sharing; Java; Spring Boot; Vue</p>
<h1 id="目-录"><a href="#目-录" class="headerlink" title="目 录"></a><strong>目 录</strong></h1><p>略（目录太长，发博客太浪费空间了删了）</p>
<h1 id="1-绪论"><a href="#1-绪论" class="headerlink" title="1 绪论"></a>1 绪论</h1><h2 id="1-1-研究背景"><a href="#1-1-研究背景" class="headerlink" title="1.1 研究背景"></a>1.1 研究背景</h2><p>随着互联网行业的迅速发展，以及移动互联网的普及，人们可以通过网络获得丰富的学习资源，使得人们的学习方式和学习效果得到了极大的提升。传统的课堂教学已经不能满足人们的学习需求，人们对于学习资源的需求越来越大。大学生可以通过各种社交网站交流日常生活或者学习心得，从各种技术论坛、社交视频网站、博客、公众号和各种资源网站获取知识和资源。但是由于互联网的知识资源质量往往良莠不齐，导致大学生们在搜集针对性学习资源时，尤其是校内资源，非常困难。</p>
<p>例如，大学生需要获取考研、考公、英语四六级等真题和学习资源，想解公共选修课的相关内容、老师，往届师兄师姐的经验分享，则需要关注大量的公众号获取相关资源和在浩瀚的互联网中搜集。想要获取校内专业课程的PPT、实验报告、期末试卷等校内资源更是难上加难，只能通过与熟悉的同学、老师沟通获取相关资源，这对于部分信息较为闭塞、社交较少的同学来说对未来的学习是不利的。</p>
<h2 id="1-2-研究意义与目的"><a href="#1-2-研究意义与目的" class="headerlink" title="1.2 研究意义与目的"></a>1.2 研究意义与目的</h2><p>针对上述问题，开发一个集成论坛社交功能与学习资源分享的平台，鼓励同学之间互助、交流，上传各种资料、分享学习生活心得，在平台参与讨论交流，拓宽学生信息渠道，促进信息资源流通。搜集各种资源不需要依托学校内的人际关系，或者在各大微信公众号和网站大海捞针，能在一定程度上解决学生之间学习信息交流封闭的问题，降低搜集资源的成本。这样的平台可以为大学生提供更好的学习资源和学习体验，促进知识的传播和交流，同时也可以帮助大学生们更好地完成学业，提高自身素质。</p>
<h2 id="1-3-国内外相关社交平台和论坛发展现状"><a href="#1-3-国内外相关社交平台和论坛发展现状" class="headerlink" title="1.3 国内外相关社交平台和论坛发展现状"></a>1.3 国内外相关社交平台和论坛发展现状</h2><h3 id="1-3-1-国内高校论坛与技术问答社区CSDN概况"><a href="#1-3-1-国内高校论坛与技术问答社区CSDN概况" class="headerlink" title="1.3.1 国内高校论坛与技术问答社区CSDN概况"></a>1.3.1 国内高校论坛与技术问答社区CSDN概况</h3><p>根据笔者在互联网的搜集与调查，国内外各大高校都有自己的BBS论坛，例如华南理工BBS、暨南大学BBS等等，这些论坛集成了求职就业、生活信息、社团组织的信息，作为师生表达观点、互帮互助、输出校园文化的重要平台。这些网站随着互联网各大社交平台的迅速发展，比如微博、虎扑、哔哩哔哩等。目前大多数学生很少浏览校内论坛，目前网站流量并不是很高，社区活跃度日渐下降，例如华南理工大学BBS论坛会员共74208人，日流量约9218，流量最高峰的时候在2017年，最高纪录是5209428，论坛功能并不能很好并且及时的满足学生获取相关资源的需要，由于BBS论坛起源于互联网刚刚兴起的时候，使用的是较老的技术，高校BBS论坛大多数使用PHP作为开发语言[1]，可以看到网站的首页图片展示还保留了已经淘汰的 Flash Player技术，2021年微软和adobe停止了对Adobe Flash Player的支持，目前大部分主流的浏览器已经不再支持flash 播放器。因此BBS论坛在无论在技术上还是在使用上都无法符合时代和学生的需要。</p>
<p>CSDN作为中文IT技术社区，包含app、博客、技术论坛和资源下载中心。其中CSDN下载中心我们可以搜索下载包含前端、后端、大数据、人工智能等各种计算机资源，但是CSDN下载需要充值C币，并且大部分资源价值不高但是价格昂贵，多为搬运GitHub的资源，并且受众有限，只适合IT从业者和计算机专业的同学[2]。</p>
<h3 id="1-3-2-国外的技术论坛Stack-Overflow"><a href="#1-3-2-国外的技术论坛Stack-Overflow" class="headerlink" title="1.3.2 国外的技术论坛Stack Overflow"></a>1.3.2 国外的技术论坛Stack Overflow</h3><p>2016年Stack Overflow的开发工程师Nick Craver在他的博客上发表过关于Stack Overflow的技术架构，Stack Overflow仅用35台服务器和.Net技术撑起了世界上最受欢迎的网站之一。Stack Overflow仅用35台服务器和.Net技术撑起了世界上最受欢迎的网站之一，2016年02月09日一天的HTTP请求数达209,420,973此，SQL查询数504,816,843，Redis命中数5,831,683,114，Elastic 查询次数17,158,874，接收数据总量569 GB，发送数据总量达3.08TB[13]。</p>
<p>在技术架构上，Stack Overflow在负载均衡使用的 HAProxy 1.5.15 和 CentOS 7，Web层架构使用IIS 8.5，ASP.Net MVC 5.2.3，和.Net 4.6.1，在缓存层使用了 Redis，Redis 服务器 256GB 内存，采用 master/slave 结构部署，Stack Overflow的搜索采用 Elasticsearch 1.4，SQL Server 是 Stack Overflow 唯一的源数据库，所有 Elastic 和 Redis 的数据都来自 SQL Server[13]。Stack Overflow架构如图1.1所示。<img src="http://img-md-js.linjsblog.top/img/202406150933372.png">{width=”4.914443350831146in” height=”3.542351268591426in”}</p>
<p>图1.1 Stack Overflow 架构</p>
<blockquote>
<p>（资料来源：Stack Overflow：架构 - 2016 年版）</p>
</blockquote>
<h1 id="2-需求分析"><a href="#2-需求分析" class="headerlink" title="2 需求分析"></a>2 需求分析</h1><h2 id="2-1-业务需求分析"><a href="#2-1-业务需求分析" class="headerlink" title="2.1 业务需求分析"></a>2.1 业务需求分析</h2><p>校内资源共享平台与交流平台支持PC网页端，基本功能包括用户中心、资源库、社区、后台管理四大模块，第三方平台登录、短信服务、分布式限流等功能。</p>
<p>用户中心：用户中心包含了用户的注册、登录、个人信息管理、个人等级与积分账户等功能。用户登录包含账号密码登录、手机验证码登录和第三方平台登录三种方式。由于国内审核的限制，开发QQ登录授权功能需要开发中认证和网站备案，所以我打算优先完成GitHub第三方平台的授权登录。</p>
<p>用户等级与积分账户：等级分为1级到6级，用户注册时等级为初始为1级，每升一级需要不同的经验，用户通过上传资源、发表帖子获得一定的经验、提升等级；用户注册成功后系统赠送200积分，用户上传资源或其他用户下载该用户上传的资源获得积分，用户可以通过获得的积分下载资源。</p>
<p>资源库：用户可以上传与下载资源，上传资源并通过审核赠送积分，提升经验等级，下载积分资源需要消耗积分。</p>
<p>搜索功能：分为主页搜索和资源库搜索，主页搜索社区模块的文章和帖子，资源库搜索资源库的相关资源。</p>
<p>社区：用户可以发表文章或帖子，文章包含点赞和评论区，评论区包含点赞和回复功能。在设计与开发时，需要考虑用户可以发表帖子或文章，浏览用户可以对其点赞、评论，同时对评论内容可以进行点赞和回复，对回复也可以进行回复和点赞。</p>
<p>搜索功能：分为主页搜索和资源库搜索，主页搜索社区模块的文章和帖子，资源库搜索资源库的相关资源。</p>
<p>系统后台管理：后台管理系统独立于平台，主要由系统管理员登录和维护，包含用户管理、社区内容审核、资源库审核等功能。</p>
<h2 id="2-2-功能需求分析"><a href="#2-2-功能需求分析" class="headerlink" title="2.2 功能需求分析"></a>2.2 功能需求分析</h2><p>用例图是系统分析和设计中一种常用的建模工具，用例图可以帮助团队明确系统的功能需求和用户需求，以便在开发过程中能够更加清晰地明确和理解系统的目标。我们将用用例图来分析平台不同角色在各个模块的权限。平台面向的主要用户是在校大学生，平台的角色主要分为普通用户和系统管理员。普通用户主要使用的模块有个人中心、资源库和社区，系统管理员主要使用后台管理系统。</p>
<p>普通用户是平台最主要的使用者，用户在个人中心可以对自己发表的文章和上传的资源，并查询资源审核的进度。并且可以对自己的个人信息进行修改、接受系统通知，查询个人等级和积分余额。用户可以查看自己在社区和资源库收藏的文章和资源，方便重复浏览文章和资源。普通用户在个人中心的用例图如下图2.1所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150940118.png" alt="image-20240615094048081"></p>
<p>图2.1 个人中心用例图</p>
<p>用户可以在社区浏览文章、搜索文章，用户登录后可以发表文章、发表评论、收藏文章和点赞文章。社区的用例图如下图2.2所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150941887.png" alt="image-20240615094120846"></p>
<p>图2.2 社区用例图</p>
<p>用户可以在资源库浏览资源，用户登录后有权使用下载资源、收藏资源等功能。用户在下载资源后才能对资源发表评论。用户在资源库的用例图如下图2.3所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150941240.png" alt="image-20240615094144190"></p>
<p>图2.2 资源库用例图</p>
<p>系统管理员主要通过后台管理系统，后台管理系统独立于校内资源共享与交流平台，实现用户管理、文章管理、资源管理、审核等功能。后台管理系统用例图如图2.3所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150942072.png" alt="image-20240615094214025"></p>
<p>图2.2 后台管理用例图</p>
<h1 id="3-系统设计"><a href="#3-系统设计" class="headerlink" title="3 系统设计"></a>3 系统设计</h1><h2 id="3-1-系统总体功能结构图"><a href="#3-1-系统总体功能结构图" class="headerlink" title="3.1 系统总体功能结构图"></a>3.1 系统总体功能结构图</h2><p>校内资源共享与交流平台主要分为四大模块，分别为社区、用户中心、资源库和后台管理系统，总体功能结构图如图3.1所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150942605.png"></p>
<p>图3.1 校内资源共享与交流平台功能结构图</p>
<h2 id="3-2-系统关键功能设计"><a href="#3-2-系统关键功能设计" class="headerlink" title="3.2 系统关键功能设计"></a>3.2 系统关键功能设计</h2><h3 id="3-2-1-基于JWT实现用户认证和授权"><a href="#3-2-1-基于JWT实现用户认证和授权" class="headerlink" title="3.2.1 基于JWT实现用户认证和授权"></a>3.2.1 基于JWT实现用户认证和授权</h3><p>一般情况下，基于JWT登录的流程一般是，用户提交登录表单，服务器返回token作为凭证，用户请求数据时在请求头携带token获取数据。但是由于JWT的无状态性，服务端不能控制用户登录和退出。所以JWT本身就是不安全的，如果token没有过期，论是谁拿到token谁都可以访问，所以我们通常会把token的有效期设置的较短，那么token过期了怎么办呢？如何实现token的续期。参照Oauth2 的实现方案，这个时候我们就要使用两个token实现JWT的续期：access_token和refresh_token。</p>
<p>access_token过期时间比较短，通常设置30分钟，refresh_token设置的比较长可以是一个小时甚至1个星期或更长。这两个token的职责不一样：access_token用于业务系统交互，是最核心的数据。refresh_token只用于向认证中心获取新的access_token与refresh_token。我们假设access_token有效期为30分钟，refresh_token为60分钟。当用户超过30分钟而不到60分钟时，access_token失效，需要通过refresh_token调用刷新接口，生成新的access_token和refresh_token返回给前端替换旧的token。如果refresh_token过期则代表用户状态过期，则前端跳转页面重新登录。</p>
<p>refresh token存在的意义是为了安全性refresh token只有在需要刷新token的时候才会发送给服务端校验，使用频率低才能降低泄露风险，而不是每次都要把refresh token发给服务端。具体时序图如图3.2所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150943274.png">{width=”5.772222222222222in” height=”4.654166666666667in”}</p>
<p>图3.2 双token解决用户登录token续签问题</p>
<h3 id="3-2-2-手机验证码登录"><a href="#3-2-2-手机验证码登录" class="headerlink" title="3.2.2 手机验证码登录"></a>3.2.2 手机验证码登录</h3><p>基于JWT的登录流程开发手机号登录和注册。由于注册和手机号登录需要使用手机号接受短信验证码，所以我们采用阿里云短信API，实现短信发送功能。手机号登录流程如下图3.3所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150943885.png">{width=”5.768055555555556in” height=”6.322222222222222in”}</p>
<p>图3.3 手机号登录流程</p>
<h3 id="3-2-3-短信接口的实现"><a href="#3-2-3-短信接口的实现" class="headerlink" title="3.2.3 短信接口的实现"></a>3.2.3 短信接口的实现</h3><p>用户填写手机号码后，点击发送短信，请求应用服务器，应用服务器请求阿里短信云服务，由阿里云短信服务向用户手机号码发送短信。</p>
<p>为了实现短信验证码的校验，我们使用Redis实现验证码的校验，设计Redis的存储结构：拼接常量前缀和UUID最后在末尾加上手机号形成Redis的key，UUID由Java自带的UUID工具类生成，code值为验证码，由用户发送的验证码与Redis中的验证码比较是否相同，如果相同，则说明验证成功，如果不相同则验证失败。用户验证码Redis存储结构如下图3.4所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150944653.png">{width=”4.438888888888889in” height=”2.4430555555555555in”}</p>
<p>图3.4 手机验证码 Redis K-V数据结构</p>
<p>短信验证码校验流程如下图3.5所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150944518.png">{width=”5.310416666666667in” height=”4.385416666666667in”}</p>
<p>图3.5 短信验证码校验流程</p>
<h3 id="3-2-4-接口的分布式限流方案设计"><a href="#3-2-4-接口的分布式限流方案设计" class="headerlink" title="3.2.4 接口的分布式限流方案设计"></a>3.2.4 接口的分布式限流方案设计</h3><p>为了防止短信服务被盗刷，或者流量比较大的接口导致系统负载过高宕机我们需要限制对接口的请求，比如根据IP和手机号码进行限制。这里我结合Redis采用令牌桶算法，并通过注解和拦截器的形式对接口的进行限流。</p>
<p>（1）令牌桶算法</p>
<p>令牌桶算法是一种用于控制流量的算法，可以确保系统在任何时候都不会因为流量超出容量而崩溃。在令牌桶算法中，一个固定数量的令牌被放入到一个”桶”中，每当一个请求到达时，系统都会尝试从桶中取出一个令牌。如果桶中没有令牌可用，请求将被拒绝或排队等待^[15]^。</p>
<p>具体而言，令牌桶算法定义了一个桶，里面装有固定数量的令牌，以及一个令牌发放速率，即每秒放入桶中的令牌数量。每当一个请求到达时，如果桶中有令牌可用，则取出一个令牌并处理请求；如果桶中没有令牌，则拒绝请求或将其放入等待队列中，直到桶中有令牌可用为止。</p>
<p>令牌桶算法的优点在于可以在一定程度上平滑地控制请求的流量，并且可以灵活地调整令牌的发放速率以适应系统的负载情况。同时，它也有一些缺点，比如可能导致请求的延迟增加或者需要一定的额外开销来实现算法。令牌桶算法如下图3.6。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150944130.png">{width=”3.952638888888889in” height=”2.2808814523184604in”}</p>
<p>图3.6 令牌桶算法示意图</p>
<p>（2）基于Redis + Lua脚本 + 令牌桶算法实现限流控制</p>
<p>部分关键代码如下：</p>
<ul>
<li>自定义注解</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">RateLimit</span> <span class="token punctuation">{</span>
    <span class="token comment">//限流唯一标示</span>
    <span class="token class-name">String</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token comment">//限流单位时间（单位为s）</span>
    <span class="token keyword">int</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">//单位时间内限制的访问次数</span>
    <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//是否限制ip</span>
    <span class="token keyword">boolean</span> <span class="token function">ipLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编写Lua脚本：</p>
<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">redis<span class="token punctuation">.</span><span class="token function">replicate_commands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 参数中传递的key</span>
<span class="token keyword">local</span> key <span class="token operator">=</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment">-- 令牌桶填充 最小时间间隔</span>
<span class="token keyword">local</span> update_len <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">-- 记录 当前key上次更新令牌桶的时间的 key</span>
<span class="token keyword">local</span> key_time <span class="token operator">=</span> <span class="token string">'ratetokenprefix'</span><span class="token operator">..</span>key
<span class="token comment">-- 获取当前时间(这里的curr_time_arr 中第一个是 秒数，第二个是 秒数后毫秒数)，由于我是按秒计算的，这里只要curr_time_arr[1](注意：redis数组下标是从1开始的)</span>
<span class="token comment">--如果需要获得毫秒数 则为 tonumber(arr[1]*1000 + arr[2])</span>
<span class="token keyword">local</span> curr_time_arr <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'TIME'</span><span class="token punctuation">)</span>
<span class="token comment">-- 当前时间秒数</span>
<span class="token keyword">local</span> nowTime <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>curr_time_arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">-- 从redis中获取当前key 对应的上次更新令牌桶的key 对应的value 上次更新时间秒数</span>
<span class="token keyword">local</span> curr_key_time <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span>key_time<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">-- 获取当前key对应令牌桶中的令牌数</span>
<span class="token keyword">local</span> token_count <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">-- 当前令牌桶的容量</span>
<span class="token keyword">local</span> token_size <span class="token operator">=</span> <span class="token function">tonumber</span><span class="token punctuation">(</span>ARGV<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">-- 令牌桶数量小于0 说明令牌桶没有初始化</span>
<span class="token keyword">if</span> token_count <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">then</span>
    redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span>key_time<span class="token punctuation">,</span>nowTime<span class="token punctuation">)</span>
    redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span>token_size <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> token_size <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">else</span>
    <span class="token keyword">if</span> token_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token comment">--当前令牌桶中令牌数够用</span>
        redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span>token_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> token_count <span class="token operator">-</span><span class="token number">1</span>   <span class="token comment">--返回剩余令牌数</span>
    <span class="token keyword">else</span>    <span class="token comment">--当前令牌桶中令牌数已清空</span>
        <span class="token keyword">if</span> curr_key_time <span class="token operator">+</span> update_len <span class="token operator">&lt;</span> nowTime <span class="token keyword">then</span>    <span class="token comment">--判断一下，当前时间秒数 与上次更新时间秒数  的间隔，是否大于规定时间间隔数 （update_len）</span>
            redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span>token_size <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span>key_time<span class="token punctuation">,</span>nowTime<span class="token punctuation">)</span>
            <span class="token keyword">return</span> token_size <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>Spring中注入拦截器</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOG</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> redisLuaScript<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">assert</span> handler <span class="token keyword">instanceof</span> <span class="token class-name">HandlerMethod</span><span class="token punctuation">;</span>
        <span class="token class-name">HandlerMethod</span> method <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethod</span><span class="token punctuation">)</span> handler<span class="token punctuation">;</span>
        <span class="token class-name">RateLimit</span> rateLimit <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getMethodAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RateLimit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前方法上有我们自定义的注解</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rateLimit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//获得单位时间内限制的访问次数</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> rateLimit<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> rateLimit<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获得限流单位时间（单位为s）</span>
            <span class="token keyword">int</span> time <span class="token operator">=</span> rateLimit<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> ipLimit <span class="token operator">=</span> rateLimit<span class="token punctuation">.</span><span class="token function">ipLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//拼接 redis中的key</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">RATE_LIMIT_KEY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果需要限制ip的话</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ipLimit<span class="token punctuation">)</span><span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">getIpAddress</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//执行lua脚本</span>
            <span class="token class-name">Long</span> execute <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisLuaScript<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> time<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">assert</span> execute <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> execute<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BaseResponse</span> resultModel <span class="token operator">=</span> <span class="token class-name">ResultUtils</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ErrorCode</span><span class="token punctuation">.</span><span class="token constant">RATE_LIMIT_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">901</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>resultModel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前接口调用超过时间段内限流,key:{}"</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前访问时间段内剩余{}次访问次数"</span><span class="token punctuation">,</span> execute<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getIpAddress</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> ipAddress <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ipAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"x-forwarded-for"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ipAddress <span class="token operator">==</span> <span class="token keyword">null</span>  ipAddress<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token string">"unknown"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>ipAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ipAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Proxy-Client-IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ipAddress <span class="token operator">==</span> <span class="token keyword">null</span>  ipAddress<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token string">"unknown"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>ipAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ipAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"WL-Proxy-Client-IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ipAddress <span class="token operator">==</span> <span class="token keyword">null</span>  ipAddress<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token string">"unknown"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>ipAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ipAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割</span>
            <span class="token comment">// "***.***.***.***".length()</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ipAddress <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ipAddress<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// = 15</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ipAddress<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ipAddress <span class="token operator">=</span> ipAddress<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ipAddress<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ipAddress <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ipAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>在controller层添加注解即可使用，具体使用方法如下图3.7所示。</li>
</ul>
<p><img src="http://img-md-js.linjsblog.top/img/202406150956361.png">{width=”5.768055555555556in” height=”2.123611111111111in”}</p>
<p>图3.7 自定义限流注解的使用</p>
<h3 id="3-2-5-第三方平台OAuth登录"><a href="#3-2-5-第三方平台OAuth登录" class="headerlink" title="3.2.5 第三方平台OAuth登录"></a>3.2.5 第三方平台OAuth登录</h3><p>（1）QQ登录开发流程如下图3.8所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150957040.png">{width=”5.772222222222222in” height=”0.81875in”}</p>
<p>图3.8 QQ登录开发流程</p>
<p>首先获取Access Token，用户点击登录按钮后，通过OAuth2.0认证获取AccessToken，对于应用而言，需要进行两步^[9]^：</p>
<p>①获取Authorization Code；</p>
<p>②通过Authorization Code获取Access Token^[14]^；</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150957477.png">{width=”5.433333333333334in” height=”4.159722222222222in”}</p>
<p>图3.9 OAuth 2.0 获取access token</p>
<blockquote>
<p>（资料来源：OAuth2.0协议草案V21的4.1节 <a target="_blank" rel="noopener" href="http://www.rfcreader.com/#rfc6749">http://www.rfcreader.com/#rfc6749</a>）</p>
</blockquote>
<p>首先获取Authorization Code。我们用通过GET方法发送HTTP请求访问<a target="_blank" rel="noopener" href="https://graph.qq.com/oauth2.0/authorize">https://graph.qq.com/oauth2.0/authorize</a>接口，请求参数如下</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150957811.png">{width=”5.646543088363955in” height=”3.687995406824147in”}</p>
<p>图3.10 获取Authorization Code请求参数</p>
<p>如果用户成功登录并授权，则会跳转到指定的回调地址，并在redirect_uri地址后带上Authorization Code和原始的state值^[9]^。例如，通过Authorization Code获取Access Token。</p>
<p>请求地址：<a target="_blank" rel="noopener" href="https://graph.qq.com/oauth2.0/token">https://graph.qq.com/oauth2.0/token</a></p>
<p>请求参数：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150957514.png">{width=”5.430003280839895in” height=”2.394012467191601in”}</p>
<p>图3.11 获取Access Token请求参数</p>
<p>返回参数：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150957416.png">{width=”5.676288276465442in” height=”1.0941174540682415in”}</p>
<p>图3.12 获取Access Token返回值</p>
<p>获取用户OpenID。通过上一步拿到的AccessToken，得到对应用户身份的OpenID。OpenID是此网站上或应用中唯一对应用户身份的标识，网站或应用可将此ID进行存储，便于用户下次登录时辨识其身份，或将其与用户在网站上或应用中的原有账号进行绑定^[9]^。</p>
<p>调用OpenID访问用户信息。调用get_user_info接口，获取用户QQ昵称、头像、性别，最后将获得的信息写入数据库保存，执行登录流程最终实现用户登录。</p>
<p>（2）GitHub登录</p>
<p>与QQ登录类似，用户跳转到Github进行授权，获取授权码，将拿到的授权码code向GitHub请求令牌，获得access token，拿到令牌后向API请求用户数据即可完成GitHub的第三方登录。</p>
<p>GitHub授权登录流程如图3.13、3.14所示</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150958021.png">{width=”5.147916666666666in” height=”2.7465277777777777in”}</p>
<p>图3.13 Github登录授权流程</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150958763.png">{width=”5.656944444444444in” height=”4.271527777777778in”}</p>
<p>图3.14 Github登录授权详细流程时序图</p>
<p>和手机验证码登录类似，第三方授权登录既可以实现注册也可以实现登录，如果用户已经注册账号和绑定了第三方账号，则自动登录，如果用户不存在，则需要保存用户信息到数据库。在从GitHub拿到用户信息跳转回平台，执行的具体逻辑如图3.15所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150958427.png">{width=”5.772222222222222in” height=”2.3229166666666665in”}</p>
<p>图3.15 Github登录授权流程</p>
<h3 id="3-2-6-文章的评论回复功能"><a href="#3-2-6-文章的评论回复功能" class="headerlink" title="3.2.6 文章的评论回复功能"></a>3.2.6 文章的评论回复功能</h3><p>为了实现文章评论区的无限盖楼回复，既用户可以对文章进行评论，也可以对评论进行回复，也可以对回复进行回复，也称多级评论。我们对评论区做出如下图3.16所示的树型结构设计。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406150958600.png">{width=”4.404166666666667in” height=”4.090972222222222in”}</p>
<p>图3.16 评论区表设计</p>
<p>以评论列表的访问为例，我们的查询SQL可能是（已简化）：</p>
<p>（1）查询时间序一级评论id列表：<code>SELECT id FROM article_cmmment WHERE</code> <code>article_id=? AND root_id=0 AND is_delete=0 ORDER BY create_time=? LIMIT</code> <code>0,20</code></p>
<p>（2）批量查询根评论基础信息：<code>SELECT \* FROM article_cmmment WHERE id in</code> <code>(?,?,\...)</code></p>
<p>（3）并发查询楼中楼评论id列表：<code>SELECT id FROM article_cmmment WHERE</code> <code>article_id =? AND root_id=? ORDER BY like_num LIMIT 0,3</code></p>
<p>（4）批量查询楼中楼评论基础信息：<code>SELECT \* FROM article_cmmment WHERE id</code> <code>in (?,?,\...)</code>^[11]^。</p>
<h3 id="3-2-7-点赞功能的设计"><a href="#3-2-7-点赞功能的设计" class="headerlink" title="3.2.7 点赞功能的设计"></a>3.2.7 点赞功能的设计</h3><p>点赞功能在文章和文章评论都有，当已登陆用户访问页面的时候，如果用户已经点赞，需要将点赞按钮高亮表示用户已经点亮，所以在前面数据库设计中，有两张表：文章点赞表article_like和文章评论点赞表comment_like,记录用户对当前文章和评论是否点赞。用户再点击一次按钮就是取消点赞。</p>
<p>因为点赞接口往往并发量较高，所以如果只有一层数据库，无论是查询和操作都需要消耗很大的性能。所以我们使用Redis作为缓存提高点赞功能的并发量和可靠性。</p>
<p>Redis缓存设计：</p>
<p>文章点赞列表如下图所示</p>
<blockquote>
<p><img src="http://img-md-js.linjsblog.top/img/202406151000884.png">{width=”5.298611111111111in” height=”1.875in”}</p>
<p>图3.17 Redis文章点赞列表</p>
</blockquote>
<p>Redis数据存储的键值对结构为Key-value=user:article:likes:{articleId}-user(userId)-score(likeTimestamp)</p>
<p>用articleId作为key，value则是一个zset，user是这篇文章点赞的用户id，score是点赞的时间，当这篇文章某用户有新的点赞操作的时候，就会用zadd的方式把最新的点赞记录加入到该zset中来^[11]^。</p>
<p>评论点赞列表与文章点赞列表类似，只不过是把key值作了调整。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151000315.png">{width=”5.683333333333334in” height=”2.098611111111111in”}</p>
<blockquote>
<p>图3.18 Redis评论点赞列表</p>
</blockquote>
<h3 id="3-2-8-资源的上传和下载"><a href="#3-2-8-资源的上传和下载" class="headerlink" title="3.2.8 资源的上传和下载"></a>3.2.8 资源的上传和下载</h3><p>资源上传后需要经过后台审核通过才能上架资源库，才能被其他用户搜索和下载。资源的上传以及审核流程如下图3.19所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151000134.png">{width=”5.601388888888889in” height=”7.651388888888889in”}</p>
<p>图3.19 资源上传审核流程图</p>
<p>用户上传的资源文件最终是保存在阿里云OSS对象存储服务上，按照传统方案，用户从前端上传的文件经过后端服务器再上传到OSS,这会占用很大一部分服务器带宽。所以采用服务端签名后由前端直传到OSS方案，比从应用服务器作为桥梁传递资源节省了一倍的带宽，由于服务端签名直传无需将Access Key暴露在前端页面，相比JavaScript客户端签名直传具有更高的安全性^[12]^。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151000003.png">{width=”5.7027777777777775in” height=”3.2395833333333335in”}</p>
<p>图3.20 服务端签名直传流程</p>
<h3 id="3-2-9-搜索功能"><a href="#3-2-9-搜索功能" class="headerlink" title="3.2.9 搜索功能"></a>3.2.9 搜索功能</h3><p>平台的搜索功能分为文章搜索和资源搜索，搜索内容的来源是ElasticSearch, 因为用户上传资源并审核通过后才能上架，所以用户上传资源后，资源信息最先保存再MySQL数据库，当管理员从后台通过审核后，将MySQL数据库中的resource表资源状态status由0改为2（0-审核中 1-审核通过 2-审核通不过），此时将资源信息写入ElasticSearch 搜索引擎。而文章的发表不需要通过审核，所以文章发表后再写入数据库的同时将文章信息写入ElasticSearch。</p>
<p>我们结合文章的发表和资源的上传流程，结合搜索功能绘画出业务流程图如图3.21与3.22所示，注意，用户搜索到的资源信息和文章新信息都来源于ElasticSearch。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151001479.png">{width=”5.045138888888889in” height=”2.8756944444444446in”}</p>
<p>图3.21 文章上传与搜索流程</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151001199.png">{width=”5.506944444444445in” height=”3.602777777777778in”}</p>
<p>图3.22 资源上传与搜索流程</p>
<h3 id="3-2-10-文章的个性化推荐"><a href="#3-2-10-文章的个性化推荐" class="headerlink" title="3.2.10 文章的个性化推荐"></a>3.2.10 文章的个性化推荐</h3><p>（1）基于内容的个性化推荐</p>
<p>基于内容的推荐算法是一种常见的推荐算法，往往使用与简单的推荐系统实现，或与其他推荐算法结合使用。它主要利用物品的属性和用户的历史行为来进行推荐。该算法假设用户会对他们以前感兴趣的物品以及与这些物品相关的物品感兴趣。因此，该算法会根据物品的属性和用户的历史行为来推荐与用户先前感兴趣的物品相似的物品^[4]^。</p>
<p>基于内容的推荐算法通常具有以下步骤：</p>
<p>特征提取：对于每个物品，从其属性中提取特征，并将这些特征组合成一个向量。例如，对于电影，可以从电影的类型、导演、演员、年份等方面提取特征。</p>
<p>用户建模：对于每个用户，使用他们的历史行为来构建用户模型。例如，对于电影推荐，可以使用用户以前观看过的电影来构建用户模型。</p>
<p>相似度计算：对于每个物品，计算其与用户模型的相似度。例如，可以使用余弦相似度或欧几里得距离等度量方式来计算相似度。</p>
<p>推荐生成：根据相似度计算，选择最相似的物品来生成推荐列表。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151002225.png">{width=”5.6in” height=”3.6902777777777778in”}</p>
<p>图3.23 基于内容的推荐算法</p>
<p>（2）用户行为数据收集和文章的标签</p>
<p>用户在发表文章时会设定文章的标签；当用户对文章进行点赞、收藏操作时，会根据用户点赞、收藏的文章所属记录历史行为数据并保存到MySQL数据库，在进行个性化推荐时，系统会分析用户的历史行为数据，使用基于内容的推荐算法为用户生成推荐内容列表。</p>
<p>（3）余弦相似度计算</p>
<p>余弦相似度用向量空间中两个向量夹角的余弦值作为衡量两个个体间差异的大小。余弦值越接近1，就表明夹角越接近0度，也就是两个向量越相似，这就叫”余弦相似性”。我们用余弦相似度来计算每个列表标签的相似度。 <img src="http://img-md-js.linjsblog.top/img/202406151041711.png" alt="image-20240615104150683"></p>
<h2 id="3-2-数据库设计"><a href="#3-2-数据库设计" class="headerlink" title="3.2 数据库设计"></a>3.2 数据库设计</h2><h3 id="3-2-1-设计原则"><a href="#3-2-1-设计原则" class="headerlink" title="3.2.1 设计原则"></a>3.2.1 设计原则</h3><ol>
<li><p>数据库版本：MySQL 8.0</p>
</li>
<li><p>字符集：utf8mb4；utf8mb3是阉割版的UTF-8字符集，只用1-3个字节表示字符，utf8mb4使用1-4个字节表示字符，存储emoji等富文本内容需要用好4个字节，因此选用utf8mb4作为MySQL字符集。^[2]^</p>
</li>
<li><p>存储引擎：InnoDB</p>
</li>
</ol>
<p>MySQL支持多种存储引擎，通过”<code>show engines</code>“查看MySQL支持的存储引擎。如图3.24所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151028188.png">{width=”5.768055555555556in” height=”1.261111111111111in”}</p>
<p>图3.24 MySQL 支持的存储引擎</p>
<p>MySQL8.0 默认的存储引擎是InnoDB，InnoDB支持事务、行级锁和外键，外键对性能有一定损耗，因此我们在业务代码中保证数据一致性。</p>
<ol start="4">
<li><p>比较规则：utf8mb4_general_ci 向下兼容5.7版本；</p>
</li>
<li><p>数据库表名命名规范：表名采用英文字母+下划线方式进行命名，举例: 表名BUSINESS_CODE_INFO组成， BUSINESS_CODE_INFO表示业务编码信息；</p>
</li>
<li><p>数据库字段名称命名规范：采用英文字母+下划线方式进行命名，举例：BUSINESS_CODE标识业务编码；</p>
</li>
<li><p>设计表结构时，不使用外键，因为使用外键会增加性能消耗，所以系统数据的一致性由业务代码维护，而不是使用外键保证数据一致性。</p>
</li>
</ol>
<h3 id="3-2-2-概念模型"><a href="#3-2-2-概念模型" class="headerlink" title="3.2.2 概念模型"></a>3.2.2 概念模型</h3><p>校内资源共享与交流平台的数据库ER图如图3.25所示：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151014484.png">{width=”5.665972222222222in” height=”5.956944444444445in”}</p>
<p>图3.25 ER图</p>
<h3 id="3-2-3-数据库表结构设计"><a href="#3-2-3-数据库表结构设计" class="headerlink" title="3.2.3 数据库表结构设计"></a>3.2.3 数据库表结构设计</h3><p>（1）文章article表结构如图表3.1所示。</p>
<p>表3.1 article表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>article_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>文章id</p>
<p>article_title</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>文章标题</p>
<p>type</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>文章类型 0-普通用户文章 1-官方文字</p>
<p>content</p>
<p>text</p>
<p>NULL</p>
<p>是</p>
<p>文章内容</p>
<p>order_images</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>文章前三章照片</p>
<p>comments_num</p>
<p>bigint</p>
<p>0</p>
<p>是</p>
<p>评论数</p>
<p>likes_num</p>
<p>bigint</p>
<p>0</p>
<p>是</p>
<p>点赞数</p>
<p>views_num</p>
<p>bigint</p>
<p>0</p>
<p>是</p>
<p>浏览数</p>
<p>collections_num</p>
<p>bigint</p>
<p>0</p>
<p>是</p>
<p>收藏数</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>发表时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>更新时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>status</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>状态 0-正常 1-下架</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>所属用户id</p>
<p>（2）文章收藏关系表</p>
<p>表3.2 article_collection表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>article_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>文章id</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>is_delete</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>修改时间</p>
<p>（3）文章评论关系表</p>
<p>表3.3 article_comment表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>评论id</p>
<p>content</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>评论内容</p>
<p>parent_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>父级评论</p>
<p>root_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>顶级评论</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>所属用户</p>
<p>article_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>所属文章</p>
<p>is_delete</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>评论时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>修改时间</p>
<p>like_num</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>点赞数量</p>
<p>（4）文章点赞表</p>
<p>表3.4 article_likes表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>article_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>文章id</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>is_delete</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>是否删除</p>
<hr>
<p>（5）文章标签表article_tags</p>
<p>表3.5 article_tags表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>标签id</p>
<p>tag_name</p>
<p>varchar(15)</p>
<p>NULL</p>
<p>否</p>
<p>标签名</p>
<p>tag_type</p>
<p>int</p>
<p>NULL</p>
<p>否</p>
<p>标签类型 0-系统标签 1-用户自定义标签</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>所属用户id</p>
<p>（6）等级表level</p>
<p>表3.6 level表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>int</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>int</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>level</p>
<p>int</p>
<p>1</p>
<p>是</p>
<p>用户等级 1-6</p>
<p>experience</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>经验</p>
<p>（7）专业表major</p>
<p>表3.7 major表</p>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>int</p>
<p>NULL</p>
<p>否</p>
<p>major_name</p>
<p>varchar(100)</p>
<p>NULL</p>
<p>否</p>
<p>专业名</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>否</p>
<p>是否删除</p>
<p>（8）消息表notice</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>title</p>
<p>varchar(100)</p>
<p>NULL</p>
<p>否</p>
<p>消息标题</p>
<p>content</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>消息内容</p>
<p>create_time</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>（9）资源表resource</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>resource_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>资源id</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>所属用户</p>
<p>resource_name</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>资源名称</p>
<p>resource_description</p>
<p>varchar(500)</p>
<p>NULL</p>
<p>是</p>
<p>资源描述</p>
<p>major_id</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>专业id</p>
<p>type</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>0-免费资源 1-付费资源</p>
<p>require_point</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>所需点数</p>
<p>status</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>0-审核中 1-审核不通过 2-审核通过</p>
<p>download_url</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>下载地址</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>更新时间</p>
<p>collection_num</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>收藏数量</p>
<p>download_num</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>下载次数</p>
<p>file_size</p>
<p>double</p>
<p>NULL</p>
<p>是</p>
<p>文件大小</p>
<p>file_type</p>
<p>char(5)</p>
<p>NULL</p>
<p>是</p>
<p>文件类型（后缀）</p>
<hr>
<p>（10）资源收藏关系表resource_collection</p>
<p>表3.10 resource_collection表</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>resource_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>资源id</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>否</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>更新时间</p>
<p>（11）资源评论表resource_comment</p>
<blockquote>
<p>表3.11 resource_comment表</p>
</blockquote>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>评论id</p>
<p>content</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>评论内容</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>所属用户id</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>评论时间</p>
<p>update_time</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>（12）资源标签表resource_tags</p>
<blockquote>
<p>表3.12 resource_tags表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>id</p>
<p>tag_name</p>
<p>varchar(15)</p>
<p>NULL</p>
<p>否</p>
<p>标签名</p>
<p>tag_type</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>0-分类（系统标签） 1-用户自定义标签</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>user_id</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>所属用户id</p>
<p>（13）文章标签关系表tag_article_rel</p>
<blockquote>
<p>表3.13 tag_article_rel表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>article_tag_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>文章标签id</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>否</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<hr>
<p>（14）资源标签关系表tag_resource_rel</p>
<blockquote>
<p>表3.14 tag_resource_rel表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>resource_tag_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>资源标签id</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>否</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>（15）院校库表university</p>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>university_name</p>
<p>varchar(100)</p>
<p>NULL</p>
<p>否</p>
<p>大学名称</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>（16）用户表user</p>
<blockquote>
<p>表3.16 user表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>username</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>用户名</p>
<p>nickname</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>昵称</p>
<p>password</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>否</p>
<p>密码</p>
<p>personal_signature</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>个性签名</p>
<p>ip_address</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>ip地址</p>
<p>avatar_url</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>头像地址</p>
<p>school</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>学校</p>
<p>phone</p>
<p>varchar(20)</p>
<p>NULL</p>
<p>是</p>
<p>手机号</p>
<p>birthday</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>生日</p>
<p>gender</p>
<p>int</p>
<p>2</p>
<p>是</p>
<p>‘0’-男 ‘1’女 ‘2’保密 默认为2</p>
<p>user_role</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>用户角色 ‘0’-普通用户 ‘1’-管理员</p>
<p>read_num</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>阅读数</p>
<p>likes_num</p>
<p>bigint</p>
<p>NULL</p>
<p>是</p>
<p>获赞数</p>
<p>accumulate_points</p>
<p>bigint</p>
<p>0</p>
<p>是</p>
<p>积分</p>
<p>status</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>账号状态是否封禁 默认为0-正常 1-封禁</p>
<p>is_delete</p>
<p>int unsigned</p>
<p>0</p>
<p>是</p>
<p>逻辑删除 默认为0</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>更新时间</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>创建时间</p>
<p>（17）用户下载资源关系表user_download_resource</p>
<blockquote>
<p>表3.17 user_download_resource表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>resource_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>资源id</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>下载时间</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>是</p>
<p>是否删除</p>
<p>（18）用户标签关系表user_tag_rel</p>
<blockquote>
<p>表3.18 user_tag_rel表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>user_tag_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户标签id</p>
<p>is_delete</p>
<p>int</p>
<p>0</p>
<p>否</p>
<p>是否删除</p>
<p>create_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>update_time</p>
<p>datetime</p>
<p>CURRENT_TIMESTAMP</p>
<p>是</p>
<p>（19）用户标签表user_tags</p>
<blockquote>
<p>表3.19 user_tags表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>标签id</p>
<p>tag_name</p>
<p>varchar(20)</p>
<p>NULL</p>
<p>否</p>
<p>标签名</p>
<p>create_time</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>创建时间</p>
<p>update_time</p>
<p>datetime</p>
<p>NULL</p>
<p>是</p>
<p>修改时间</p>
<p>is_delete</p>
<p>int</p>
<p>NULL</p>
<p>是</p>
<p>是否删除</p>
<p>（20）第三方平台绑定表oauth</p>
<blockquote>
<p>表3.20 oauth表</p>
</blockquote>
<hr>
<p>字段名</p>
<p>数据类型</p>
<p>默认值</p>
<p>是否允许为空</p>
<p>字段说明</p>
<p>id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>主键id</p>
<p>user_id</p>
<p>bigint</p>
<p>NULL</p>
<p>否</p>
<p>用户id</p>
<p>auth_type</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>第三方平台类型- QQ、GitHub等</p>
<p>open_id</p>
<p>varchar(255)</p>
<p>NULL</p>
<p>是</p>
<p>第三方平台用户的openId</p>
<h2 id="3-3-技术选型"><a href="#3-3-技术选型" class="headerlink" title="3.3 技术选型"></a>3.3 技术选型</h2><h3 id="3-3-1-前端技术路线"><a href="#3-3-1-前端技术路线" class="headerlink" title="3.3.1 前端技术路线"></a>3.3.1 前端技术路线</h3><p>（1）Vue 3.0开发框架</p>
<p>Vue是一款用于构建用户界面的渐进式JavaScript框架，它基于标准 HTML、CSS 和 JavaScript 构建，并提供了一套声明式的、组件化的编程模型，帮助高效地开发用户界面。无论是简单还是复杂的界面，Vue 都可以胜任。^[5]^</p>
<p>（2）Ant Design Vue组件库</p>
<p>使用 Vue 实现的遵循 Ant Design 设计规范的高质量 UI 组件库，用于开发和服务于企业级中后台产品，可以简化前端的开发。</p>
<p>（3）Vite</p>
<p>Vite是下一代前端开发和构建工具，使用Vite能够显著提升前端开发体验，随着构建越来越大型的应用时，需要处理的 JavaScript 代码量也呈指数级增长，基于 JavaScript 开发的工具就会开始遇到性能瓶颈，如Web应用重启缓慢。Vite 旨在利用生态系统中的新进展解决上述问题：浏览器开始原生支持 ES 模块，且越来越多 JavaScript 工具使用编译型语言编写。</p>
<h3 id="3-3-2-后端技术路线"><a href="#3-3-2-后端技术路线" class="headerlink" title="3.3.2 后端技术路线"></a>3.3.2 后端技术路线</h3><p>（1）主语言：Java</p>
<p>Java具有面向对象、平台无关性、可靠性、支持多线程、安全性、解释与编译并存等特点，并且Java拥有强大的生态和社区支持。</p>
<p>（2）Spring Boot</p>
<p>Spring 是一款开源的轻量级 Java 开发框架，旨在提高开发人员的开发效率以及系统的可维护性。Spring 支持 IoC（Inversion of Control:控制反转） 和 AOP (Aspect-Oriented Programming:面向切面编程)、可以很方便地对数据库进行访问、可以很方便地集成第三方组件（电子邮件，任务，调度，缓存等等）。</p>
<p>Spring Boot 旨在简化 Spring 开发，Spring Boot 只是简化了配置，如果你需要构建 MVC 架构的 Web 程序，你还是需要使用 Spring MVC 作为 MVC 框架，只是说 Spring Boot 帮你简化了 Spring MVC 的很多配置，真正做到开箱即用</p>
<p>（3）MyBatis</p>
<p>MyBatis框架是一个开源的数据持久层框架。内部封装了通过JDBC访问数据库的操作，支持普通的SQL查询、存储过程和高级映射，几乎消除了所有的JDBC代码和参数的手工设置以及结果集的检索。MyBatis作为持久层框架，其主要思想是将程序中的大量SQL语句剥离出来，配置在配置文件当中，实现SQL的灵活配置。</p>
<p>（3）MyBatis-Plus</p>
<p>MyBatis-Plus简单的来说就是MyBatis的增强工具，在MyBatis的基础上只做增强不做改变，可以简化开发提高效率。MyBatis-Plus无侵入性、损耗小，内置通用Mapper、通用Service，通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求。支持Lambda形式调用，内置分页插件，因此使用MyBatis-Plus可以大幅提升开发效率。</p>
<p>（4）MySQL数据库</p>
<p>MySQL是关系型数据库管理系统，我们将使用MySQL8.0版本，InnoDB和MyISAM作为MySQL的主要存储引擎，InnoDB支持事务和行级锁、支持在数据库异常崩溃后的安全恢复，而MyISAM并不支持，在很多一直场景中，InnoDB的速度都可以让MyISAM望尘莫及，尤其是用到了聚簇索引，或者需要访问的数据都可以放入内存的应用，因此选择InnoDB作为存储引擎；MySQL将实现校内资源共享与交流平台最主要的数据库，Redis缓存和 Elasticsearch 中的数据都来源于MySQL，并会定时持久化到MySQL中。</p>
<p>（5）Redis</p>
<p>是开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。Redis单线程、使用多路IO复用模型，由于Redis基于内存，绝大部分请求是纯粹的内存操作，非常快速；Redis可以用来实现评论区和文章的点赞功能，并作为缓存和中间件提高系统性能。</p>
<p>（6）RabbitMQ</p>
<p>RabbitMQ是一种消息队列中间件，消息队列可以实现异步通信、流量削峰、解耦等功能,，RabbitMQ基于AMQP协议，具有易用性、扩展性、可靠性和高可用性等特点。在项目开发中，RabbitMQ将于MySQL和Redis结合使用，通过读取Binlog异步删除缓存，保证Redis缓存和MySQL的数据一致性。</p>
<p>（7）ElasticSearch搜索引擎</p>
<p>简单地说，ElasticSearch是一个分布式的使用 REST 接口的搜索引擎，是基于Apache Lucene(TM)的开源搜索引擎，无论在开源还是专有领域，Lucene 可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。完全基于Java语言开发，支持集群，面向文档，持久化。校内资源共享于交流平台的资源库搜索和社区搜索功能通过ElasticSearch的分词器和倒排索引实现。^[6]^</p>
<p>（8）Spring Security安全框架</p>
<p>Spring Security是一个功能强大、可高度定制的身份验证和访问控制框架。在和Spring 家族的其他成员如 Spring Boot、Spring Cloud等进行整合时，具有其他框架无可比拟的优势，同时对 OAuth2 有着良好的支持。具有身份认证、授权、防护攻击、加密、会话管理等功能。^[7]^</p>
<p>（9）JSON Web Token</p>
<p>是目前最流行的跨域认证解决方案，其本质是一个token，就是用过JSON形式作为Web应用中的令牌，用于在各方之间（例如前后端之间、A系统与B系统之间）安全地传输信息。由于此信息是经过数字签名的，因此可以被验证和信任。由头部（header）、载荷（payload）、签名（signature）组成。主要用于鉴权。</p>
<p>（10）阿里云OSS对象存储服务</p>
<p>是一款海量、安全、低成本、高可靠的云存储服务。支持Restful API、SDK接口访问OSS，支持多种存储方式。数据以对象（Object）的形式存储在OSS的存储空间（Bucket）中。支持海量的用户并发访问。主要用于实现文件资源的上传下载和管理功能。^[12]^</p>
<h2 id="3-4-平台架构设计"><a href="#3-4-平台架构设计" class="headerlink" title="3.4 平台架构设计"></a>3.4 平台架构设计</h2><p>前端Vue项目打包后，使用Nginx作为静态HTTP服务器，并将后端请求通过负载均衡反向代理到后端服务器。后端通过编写Dockerfile打包成Docker容器镜像。可以在微信云托管、安装有Docker阿里云服务器上发布，至于Redis、Elastic Search和MySQL等数据库则通过docker安装在阿里云服务器和百度云上。平台的部署架构图如图3.26所示。为了更清新的展示平台不同层次采用的技术，我们根据平台前后端的技术路线，我们将系统的技术架构分为网络通信端、前端服务、后端服务、数据存储服务和部署环境的技术架构,如图3.27所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151024054.png">{width=”5.665277777777778in” height=”3.7916666666666665in”}</p>
<p>图3.26 系统部署架构图</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151024449.png">{width=”5.75625in” height=”7.790277777777778in”}</p>
<p>图3.27 系统技术架构图</p>
<h1 id="4-系统实现"><a href="#4-系统实现" class="headerlink" title="4 系统实现"></a>4 系统实现</h1><h2 id="4-1-注册"><a href="#4-1-注册" class="headerlink" title="4.1 注册"></a>4.1 注册</h2><p>用户注册填写用户名（用户名用作账号登录），用户名必须唯一，昵称可以重复，密码，确认密码，并校验密码和确认密码相同，获取手机验证码绑定手机号，每次获取验证码间隔60s。点击注册按钮执行注册逻辑，如果手机号已经绑定已有账号，则返回错误信息；注册成功执行登录逻辑跳转至首页（社区）。用户注册成功后，为用户添加200积分。注册页面如图4.1 所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151024098.png">{width=”4.906944444444444in” height=”5.395138888888889in”}</p>
<p>图4.1 注册页面图</p>
<h2 id="4-2-手机号登录"><a href="#4-2-手机号登录" class="headerlink" title="4.2 手机号登录"></a>4.2 手机号登录</h2><p>手机号登录同时具有注册和登录两种功能，需验证真实的手机号，每次获取验证码等待60s，如果该手机号用户没有注册则自动注册并登录跳转主页，系统会自动为用户生成用户名、昵称等默认的个人信息，并为用户赠送200积分。如果用户存在执行登录操作跳转主页（社区）。手机号登录页面如图4.2所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151024201.png">{width=”5.233333333333333in” height=”3.9166666666666665in”}</p>
<p>图4.2 手机号登录页面</p>
<h2 id="4-3-账号密码登录"><a href="#4-3-账号密码登录" class="headerlink" title="4.3 账号密码登录"></a>4.3 账号密码登录</h2><p>与传统的账号密码登录别无二致，账号使用注册时的用户名，如果用户名不存在或密码不正确，则返回错误信息。登录成功跳转至首页（社区）。账号密码登录页面如下图4.3所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151024359.png">{width=”5.252777777777778in” height=”3.9625in”}</p>
<p>图4.3 用户名密码登录</p>
<h2 id="4-4-第三方平台登录"><a href="#4-4-第三方平台登录" class="headerlink" title="4.4 第三方平台登录"></a>4.4 第三方平台登录</h2><h3 id="4-1-1-QQ登录"><a href="#4-1-1-QQ登录" class="headerlink" title="4.1.1 QQ登录"></a>4.1.1 QQ登录</h3><p>用户点击按钮之后弹出QQ登录的窗口，在登录窗口中将显示网站自己的Logo标识，网站名称以及首页链接地址^[9]^。如图4.4所示：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025023.png">{width=”4.836837270341207in” height=”2.7008497375328084in”}</p>
<p>图4.4 QQ登录</p>
<p>（资料来源：<a target="_blank" rel="noopener" href="https://wiki.connect.qq.com/%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B">https://wiki.connect.qq.com/网站应用接入流程</a> ）</p>
<p>如果用户已登录QQ软件，就不用重复输入帐号密码，可以一键实现快速登录并且可以选择授权允许网站访问自己的相关信息，如图4.5所示：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025870.png">{width=”5.17837489063867in” height=”2.9520352143482063in”}</p>
<p>图4.5 QQ登录</p>
<p>（资料来源：<a target="_blank" rel="noopener" href="https://wiki.connect.qq.com/%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B">https://wiki.connect.qq.com/网站应用接入流程</a> ）</p>
<h3 id="4-4-2-Github登录"><a href="#4-4-2-Github登录" class="headerlink" title="4.4.2 Github登录"></a>4.4.2 Github登录</h3><p>一个链接让用户跳转到GitHub，Github会让用户登录，登录后GitHub会询问用户，该应用正在请求数据，你是否统一授权。用户统一授权后，GitHub会跳转回应用^[8]^。Github授权页面如图4.6所示。</p>
<blockquote>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025655.png">{width=”3.832437664041995in” height=”3.380952537182852in”}</p>
</blockquote>
<p>图4.6 Github授权页面</p>
<h2 id="4-5-个人中心"><a href="#4-5-个人中心" class="headerlink" title="4.5 个人中心"></a>4.5 个人中心</h2><p>个人中心包含展示当前用户的基本信息，个人中心包含的功能有内容管理-我的投稿、我的收藏，个人信息设置，等级、积分系统，收藏的文章、资源和消息中心，进入个人中心时，默认路由到我的投稿页面。个人中心需要做好相关的权限控制，未登录用户和非当前用户只能展示顶部的信息卡片和历史投稿和上传的资源。只有登录的用户才能看到自己的个人信息卡片下方的功能展示，用户点击左下方的侧导航栏，路由到各个子页面组件如”我的资源”、”我的积分”等页面。个人中心首页如下图4.7所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025335.png">{width=”5.772222222222222in” height=”2.4340277777777777in”}</p>
<p>图4.7 个人中心页面</p>
<h3 id="4-5-1-投稿管理"><a href="#4-5-1-投稿管理" class="headerlink" title="4.5.1 投稿管理"></a>4.5.1 投稿管理</h3><p>投稿管理展示当前用户发表的文章，点击删除按钮弹出对话框是否删除当前文章。点击编辑按钮跳转文章编辑页。点击文章标题跳转文章详情页。点击”点我立即投稿”按钮跳转文章发表页。个人中心-我的投稿如图4.8所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025851.png">{width=”5.5579593175853015in” height=”3.2630938320209975in”}</p>
<p>图4.8 个人中心-我的投稿页面</p>
<h3 id="4-5-2-资源管理管理"><a href="#4-5-2-资源管理管理" class="headerlink" title="4.5.2 资源管理管理"></a>4.5.2 资源管理管理</h3><p>“我的资源”展示当前用户发表的文件，用户可以对自己上传的资源进行删除，显示用户上传资源的审核状态。点击”上传资源”按钮跳转上传资源页面。”我的资源”页面如图4.9所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025241.png">{width=”5.772222222222222in” height=”6.211111111111111in”}</p>
<p>图4.9 个人中心-我的资源页面</p>
<h3 id="4-5-3-上传个人头像"><a href="#4-5-3-上传个人头像" class="headerlink" title="4.5.3 上传个人头像"></a>4.5.3 上传个人头像</h3><p>上传头像：点击上传照片将照片上传至OSS保存并回显至前端，点击保存更新数据库和前端的头像地址。上传和更新个人头像如下图4.10所示</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025124.png">{width=”5.772222222222222in” height=”2.634027777777778in”}</p>
<p>图4.10 个人中心-上传头像</p>
<h3 id="4-5-4-编辑资料"><a href="#4-5-4-编辑资料" class="headerlink" title="4.5.4 编辑资料"></a>4.5.4 编辑资料</h3><p>用户名不可更改，如果用户没有绑定手机，则显示绑定手机链接，如果用户已经绑定手机号则显示手机号，隐藏中间第4-8位数，点击更换手机弹出对话框，输入手机号获取验证码绑定手机号。院校库信息由爬虫批量导入数据库，前端从后台查询所有院校，编辑资料页面和绑定手机号弹框如下图4.11和4.12所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151025640.png">{width=”5.573611111111111in” height=”3.477777777777778in”}</p>
<p>图4.11 个人中心-编辑资料页面</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026112.png">{width=”5.619047462817148in” height=”3.179304461942257in”}</p>
<p>图4.12 绑定手机号对话框</p>
<h3 id="4-5-5-等级系统"><a href="#4-5-5-等级系统" class="headerlink" title="4.5.5 等级系统"></a>4.5.5 等级系统</h3><p>用户等级分为Lv1至Lv6,用户初始等级为Lv1，每个等级升级所需的经验都不同。升级到lv6后经验不在增加。可通过如下每日奖励规则获取经验升级：点赞文章增加2经验、收藏文章增加2经验，发表文章增加10经验，上传资源增加10经验,，经验的获取有限制次数，限制次数会在每天0点清零。我的等级页面如下图4.13所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026930.png">{width=”5.772222222222222in” height=”3.4590277777777776in”}</p>
<p>图4.13 等级系统页面</p>
<h3 id="4-5-6-积分系统"><a href="#4-5-6-积分系统" class="headerlink" title="4.5.6 积分系统"></a>4.5.6 积分系统</h3><p>用户可以完成每日任务来获取积分，例如，新用户注册平台自动赠送200积分、上传一次资源并通过审核赠送10积分等。”我的积分”页面用户展示当前用户的积分余额和获取积分的规则，”我的积分”页面如下图所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026400.png">{width=”5.772222222222222in” height=”3.5722222222222224in”}</p>
<p>图4.14 积分系统页面</p>
<h3 id="4-5-7-消息中心"><a href="#4-5-7-消息中心" class="headerlink" title="4.5.7 消息中心"></a>4.5.7 消息中心</h3><p>系统通知主要有资源审核通知和文章资源被平台下架通知。按照时间顺序排序。消息中心页面如图4.15所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026149.png">{width=”5.360416666666667in” height=”3.15in”}</p>
<p>图4.15 消息中心</p>
<h2 id="4-6-首页文章展示"><a href="#4-6-首页文章展示" class="headerlink" title="4.6 首页文章展示"></a>4.6 首页文章展示</h2><p>社区文章展示模块，分为个性化推荐的文章、热门文章、最新文章三个栏目，可以根据导航栏进行切换。首页的文章列表由一个个文章卡片组成。首页的每个文章卡片展示文章的作者昵称、作者等级、发表时间、发表类型：分为官方和非官方两种类型、文章标题，并截取文章主体内容前20个字作为文章概要，每个文章卡片最多显示3章图片作文文章的封面图片，显示文章所携带的标签（包括系统默认标签和自定义标签，最多展示4个），显示文章数据：浏览量、点赞数、评论数。</p>
<h3 id="4-6-1-热门文章"><a href="#4-6-1-热门文章" class="headerlink" title="4.6.1 热门文章"></a>4.6.1 热门文章</h3><p>根据文章的用户点击量、点赞数、评论数、收藏量四个指标综合评价计算分数作为热度进行排序。文章综合分数越高，排名越高。展示越靠前。热门文章显示的是当月发表的热度排行的前10名。榜单数据会每隔10分钟会同步更新1次。热门文章平台界面如下图4.16所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026045.png">{width=”5.772222222222222in” height=”2.560416666666667in”}</p>
<p>图4.16 热门文章</p>
<h3 id="4-6-2-最新文章列表的分页懒加载"><a href="#4-6-2-最新文章列表的分页懒加载" class="headerlink" title="4.6.2 最新文章列表的分页懒加载"></a>4.6.2 最新文章列表的分页懒加载</h3><p>最新文章列表主要展示用户最新发表的文章，按照文章按照时间顺序排序。</p>
<p>系统一般不会一次性显示所有文章列表，否则在数据量非常大的情况下会对数据库和应用系统造成很大的压力。用户通过点击文章列表默认的”点击加载更多内容”向下延伸展示下一分页的文章卡片，如图4.17 所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026515.png">{width=”5.7027777777777775in” height=”4.305555555555555in”}</p>
<p>图4.17 文章懒加载</p>
<h2 id="4-7-文章发表和文章编辑"><a href="#4-7-文章发表和文章编辑" class="headerlink" title="4.7 文章发表和文章编辑"></a>4.7 文章发表和文章编辑</h2><p>用户点击首页”发表文章”进入文章编辑页，文章标题限30字，文章主体字数统一限制文章最大字数为20000个字符。文章内容前端使用markdown编辑器实现，方便文章内容在各大平台的迁移和复制。用户在文章插入图片时将图片上传至云端存储OSS，如果图片来自其他链接则不必上传。用户可以自定义标签和选择系统默认标签，每个文章最多携带5个标签。封面图片最多上传三张。上传的封面图片会在文章首页的文章卡片列表展示。而文章编辑页与文章发表页一致，文章编辑页会在各项表单显示文章的内容，允许用户修改并提交文章内容、标题、标签和封面图片。文章发表页面如图4.18所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151026711.png">{width=”5.528150699912511in” height=”6.558781714785652in”}</p>
<p>图4.18 文章发表页面</p>
<h2 id="4-8-文章详情页"><a href="#4-8-文章详情页" class="headerlink" title="4.8 文章详情页"></a>4.8 文章详情页</h2><p>在首页点击文章标题进入文章详情页，如果当前文章属于当前登录用户，则显示编辑按钮，如果该文章不属于当前用户则不显示编辑按钮。点击编辑按钮跳转至文章编辑页（文章发表页），前后端需对文章编辑做权限控制，如果不是文章不属于当前用户，则拒绝跳转，后端需对用户更新文章进行权限校验。用户点赞文章功能：用户点击点赞，则点赞按钮高亮，点赞数+1，如果用户已经点赞，再点一次取消高亮，点赞数-1。用户点击收藏，收藏按钮高亮，再点一次取消收藏，逻辑与点赞相似，并将收藏的文章加入用户收藏列表。用户点赞和收藏的文章之后可以在用户中心管理和查看。文章详情页如图4.19、4.20所示</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151027512.png">{width=”5.501695100612423in” height=”3.321813210848644in”}</p>
<p>图4.19 文章详情页页头</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151027245.png">{width=”5.768055555555556in” height=”1.761111111111111in”}</p>
<p>图4.20 文章详情页末尾</p>
<h2 id="4-9-文章评论区"><a href="#4-9-文章评论区" class="headerlink" title="4.9 文章评论区"></a>4.9 文章评论区</h2><p>评论区在每篇文章的下方。</p>
<p>评论的基础模块^[10]^：</p>
<p>①发布评论：支持无限盖楼回复；</p>
<p>②读取评论：按照时间、热度（点赞数量）；</p>
<p>③删除评论：系统管理员删除；</p>
<p>④评论互动：点赞。</p>
<p>评论区如图4.21所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151027077.png">{width=”5.545833333333333in” height=”4.019444444444445in”}</p>
<p>图4.21 文章评论区</p>
<h2 id="4-10-资源库"><a href="#4-10-资源库" class="headerlink" title="4.10 资源库"></a>4.10 资源库</h2><p>资源库主要用来为学生提供查找、下载资源的地方资源库主页如下图所示，最顶部展示轮播图，中间筛选栏用于根据资源的形式、分类、专业、格式筛选查找资源。可以与搜索栏合并搜索，下方的资源列表默认展示最新资源。资源只能展示审核通过的资源。资源库主页如图4.22所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151027995.png">{width=”4.466330927384077in” height=”5.898252405949257in”}</p>
<p>图4.22 资源库主页</p>
<h2 id="4-11-资源上传"><a href="#4-11-资源上传" class="headerlink" title="4.11 资源上传"></a>4.11 资源上传</h2><p>资源上传的文件大小限制在2GB，每次最多上传一个文件。如果要上传多个文件需要打包成压缩包。用户可为资源自定义标签，每个资源用户最多定义三个标签。所需分类、发布形式在数据库中都属于系统初始标签，专业从专业数据库搜索。如果用户发布形式选择积分资源，则需填写所需积分，积分必须为整数，下载资源所需积分的最大限度为500积分。资源上传后需要经过后台审核通过才能上架资源库，才能被其他用户搜索到。资源上传页面如下图4.23所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151028297.png">{width=”5.7097123797025375in” height=”5.838853893263342in”}</p>
<p>图4.23 资源上传</p>
<h2 id="4-12-资源详情页"><a href="#4-12-资源详情页" class="headerlink" title="4.12 资源详情页"></a>4.12 资源详情页</h2><p>资源详情页第一张卡片展示资源的基本信息：资源标题，资源标签，下载所需积分，下载量，收藏量，资源文件大小，上传时间，资源上传者头像和昵称。</p>
<p>点击立即下载，从对象存储服务下载文件，下载量+1，点击收藏将资源添加到个人的收藏列表（数据库添加关联信息），收藏量+1。第二张卡片，显示资源的简介。资源详情页如图4.24所示。</p>
<p><img src="http://img-md-js.linjsblog.top/img/202406151028711.png">{width=”4.8541393263342085in” height=”7.04696741032371in”}</p>
<p>图4.24 资源详情页</p>
<p>相比起文章评论区，资源评论区的结构要简单的多，并不需要实现无限盖楼的效果，只是一维的评论列表，并实现分页功能。只包含发表评论的用户头像、昵称、评论内容、发表时间。只有下载资源才能发表评论。发表评论获得5积分，每个资源发表评论只能获得一次积分。</p>
<h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h1><p>本文介绍了一款基于前后端分离架构的校内资源共享和交流平台的设计和实现。该平台主要由后端和前端两部分组成，后端采用Java语言、Spring Boot框架、MyBatis作为持久层、Spring Security作为安全框架和MySQL数据库开发，同时结合Redis缓存、RabbitMQ消息中间件、ElasticSearch搜索引擎等分布式中间件提高系统可靠性，前端则采用Vue 3.0和Ant Design Vue实现。</p>
<p>在系统的设计阶段，首先对平台进行了需求分析，确定了功能模块和用例，然后进行了系统的架构设计，包括系统的模块划分、组件之间的关系、接口的设计和实现等。在实现过程中，采用了Spring Boot框架和MyBatis作为持久层，实现了资源上传、下载、浏览和搜索等功能。同时，采用了Redis缓存、RabbitMQ消息中间件、ElasticSearch搜索引擎等分布式中间件提高系统的可靠性和性能。在前端实现方面，采用了Vue 3.0和Ant Design Vue框架，实现了用户注册、登录、资源上传、下载、浏览和搜索等功能。</p>
<p>在测试阶段，通过对系统进行了功能测试、性能测试和安全测试，证明了系统的功能和性能符合预期，并保证了系统的安全性。</p>
<p>在项目完成后，我们对该平台的创新点和不足进行了分析。创新点主要体现在采用前后端分离架构、采用Spring Security安全框架和结合Redis缓存、RabbitMQ消息中间件、ElasticSearch搜索引擎等分布式中间件提高系统可靠性。不足主要是在用户体验和部分功能上仍有改进空间，例如页面UI、资源推荐、社交互动等方面。</p>
<p>总的来说，该平台在校内资源共享和交流方面有着广泛的应用前景和社会价值，同时也对技术能力进行了全面提升。未来，我将进一步完善该平台的功能和性能，提高用户体验，为学生提供更好的服务。</p>
<blockquote>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li><p>李鹏飞. 基于Web技术的校园论坛设计与实现[D]. 内蒙古科技大学, 2019.</p>
</li>
<li><p>李胜利,钟滢.中外技术问答社区的实证对比研究与启示——以CSDN和Stack Overflow为例[J]. 情报学报, 2020, 39(09): 989-1000.</p>
</li>
<li><p>小孩子4919. MySQL是怎样运行的[M]. 北京:人民邮电出版社, 2020:34-36.</p>
</li>
<li><p>杨博, 赵鹏飞. 推荐算法综述[J]. 山西大学学报(自然科学版), 2011, 34(03): 337-350.</p>
</li>
<li><p>刘亚茹, 张军. Vue.js框架在网站前端开发中的研究[J]. 电脑编程技巧与维护, 2022(01):18-19+39.</p>
</li>
<li><p>柳帆. 基于ElasticSearch的科技资源检索系统的研究与实现[J]. 现代计算机, 2021, 27(26): 93-100.</p>
</li>
<li><p>刘姚. 基于Spring和OAuth2.0的第三方授权框架[J]. 计算机技术与发展, 2017, 27(03): 167-170.</p>
</li>
<li><p>阮一峰. GitHub OAuth 第三方登录示例教程[EB/OL]. (2019-04-21)[2023-03-08]. <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/04/github-oauth.html">https://www.ruanyifeng.com/blog/2019/04/github-oauth.html</a></p>
</li>
<li><p>QQ互联. 网站应用接入[EB/OL]. (2016-08-20)[2023-03-08]. <a target="_blank" rel="noopener" href="https://wiki.connect.qq.com/%e7%bd%91%e7%ab%99%e5%ba%94%e7%94%a8%e6%8e%a5%e5%85%a5%e6%b5%81%e7%a8%8b">https://wiki.connect.qq.com/%e7%bd%91%e7%ab%99%e5%ba%94%e7%94%a8%e6%8e%a5%e5%85%a5%e6%b5%81%e7%a8%8b</a></p>
</li>
<li><p>黄振. B站评论架构设计[EB/OL]. (2022-12-09)[2023-03-08]. <a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv20346888">https://www.bilibili.com/read/cv20346888</a></p>
</li>
<li><p>芦文超. B站千亿级点赞系统服务架构设计[EB/OL]. (2023-02-03)[2023-03-08]. <a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv21576373">https://www.bilibili.com/read/cv21576373</a></p>
</li>
<li><p>阿里云. 阿里云OSS产品文档-最佳实践-服务端签名后直传[EB/OL]. (2022-12-26)[2023-03-08]. <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31926.html">https://help.aliyun.com/document_detail/31926.html</a></p>
</li>
<li><p>Nick Craver. Stack Overflow: The Architecture - 2016 Edition[EB/OL]. <a target="_blank" rel="noopener" href="https://nickcraver.com/blog/2016/02/17/stack-overflow-the-architecture-2016-edition/">https://nickcraver.com/blog/2016/02/17/stack-overflow-the-architecture-2016-edition/</a></p>
</li>
<li><p>D. Hardt, Ed. The OAuth 2.0 Authorization Framework[DB/OL]. (2012-10-01)[2023-03-08].<a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc6749#section-4.1">https://www.rfc-editor.org/rfc/rfc6749#section-4.1</a></p>
</li>
<li><p>Wikipedia. Token bucket[DB/OL]. (2023-02-07)[2023-03-08]. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Token_bucket">https://en.wikipedia.org/wiki/Token_bucket</a></p>
</li>
</ol>
</blockquote>
<h1 id="致-谢"><a href="#致-谢" class="headerlink" title="致 谢"></a>致 谢</h1><p>在完成本文之际，首先还是要感谢在大学四年坚持自我学习、不懈补拙的自己。虽然在大学期间我完成通过团队或个人完成了不少类似于这次毕业设计的项目，但这次毕业设计是我四年独立完成、工作量最大、涉及技术面最广、最新、最难的一次项目，是我在大学所学计算机知识和相关技术栈的融会贯通，从2022年末开题至2023年3月底完成论文，中间花费了较多的时间和精力，没有长时间的学习和积累是无法完成的。</p>
<p>其次，要感谢帮助我在大一学习职业目标比较迷茫的时候为我指引方向的学长学姐，校园网络中心是我在大学唯一没有后悔加入校级组织，这里的学长学姐非常友好，遇到什么问题都会互帮互助，平时的活动也很少，是一个学习性组织，也是因为这些机遇，在前辈的指引下让我认识并参加大学计算机竞赛例如蓝桥杯等，让我明确之后的学习和职业方向，在大学期间不断紧随潮流学习新技术、夯实基础，为我在后来的开发以及大四找工作、考研提供很大的帮助。我的大学生涯相对来说单调一些，当然也有疫情的影响，在其他人看来，我比较特立独行，喜欢独处，喜欢独立思考、独立解决问题，更多的时间是在学习技术上，为找工作准备，也参加过研究生考试初试，不过很遗憾没有进入复试，庆幸的是秋招签了一家公司，打算先干着。总之，还是很感谢一路过来帮助我的同学和老师们。</p>
<p>最后要感谢的是我的论文指导老师张顺超老师，非常感谢老师花费时间和精力愿意指导和修改我的论文，不然我的论文可能会显得很不规范和粗糙。值此提交论文之时，向一路走来帮助我的人致以由衷的感谢。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">qwq小小舒</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://js6288.github.io/2024/06/15/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1-%E6%A0%A1%E5%86%85%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E4%B8%8E%E4%BA%A4%E6%B5%81%E5%B9%B3%E5%8F%B0%E5%88%A0%E6%94%B9/">https://js6288.github.io/2024/06/15/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1-%E6%A0%A1%E5%86%85%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E4%B8%8E%E4%BA%A4%E6%B5%81%E5%B9%B3%E5%8F%B0%E5%88%A0%E6%94%B9/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">qwq小小舒</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java/">
                                    <span class="chip bg-color">Java</span>
                                </a>
                            
                                <a href="/tags/%E7%AE%97%E6%B3%95/">
                                    <span class="chip bg-color">算法</span>
                                </a>
                            
                                <a href="/tags/redis/">
                                    <span class="chip bg-color">redis</span>
                                </a>
                            
                                <a href="/tags/%E6%AF%95%E4%B8%9A%E8%AE%BA%E6%96%87/">
                                    <span class="chip bg-color">毕业论文</span>
                                </a>
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                                <a href="/tags/Spring-Boot/">
                                    <span class="chip bg-color">Spring Boot</span>
                                </a>
                            
                                <a href="/tags/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/">
                                    <span class="chip bg-color">毕业设计</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay1.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2024/06/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC1%E7%AB%A0%EF%BC%88%E6%A6%82%E8%BF%B0%EF%BC%89/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="计算机网络第1章（概述）">
                        
                        <span class="card-title">计算机网络第1章（概述）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-06-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="chip bg-color">计算机网络</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/06/15/%E3%80%90%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0%E7%A7%91%E6%99%AE%E3%80%91-sata-m-2-ngff-nvme%E7%AD%89%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%8C%E8%A7%A3%E8%AF%BB%E7%A1%AC%E7%9B%98%E7%9A%84/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="【硬盘购买科普】 SATA M.2 NGFF NVME等是什么意思，解读硬盘的总线、协议和接口">
                        
                        <span class="card-title">【硬盘购买科普】 SATA M.2 NGFF NVME等是什么意思，解读硬盘的总线、协议和接口</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-06-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            <a href="/categories/%E7%A7%91%E6%99%AE/" class="post-category">
                                    科普
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/M-2/">
                        <span class="chip bg-color">M.2</span>
                    </a>
                    
                    <a href="/tags/Nvme/">
                        <span class="chip bg-color">Nvme</span>
                    </a>
                    
                    <a href="/tags/PCIE/">
                        <span class="chip bg-color">PCIE</span>
                    </a>
                    
                    <a href="/tags/SATA/">
                        <span class="chip bg-color">SATA</span>
                    </a>
                    
                    <a href="/tags/SSD/">
                        <span class="chip bg-color">SSD</span>
                    </a>
                    
                    <a href="/tags/%E7%A1%AC%E7%9B%98/">
                        <span class="chip bg-color">硬盘</span>
                    </a>
                    
                    <a href="/tags/%E7%A7%91%E6%99%AE/">
                        <span class="chip bg-color">科普</span>
                    </a>
                    
                    <a href="/tags/%E8%A3%85%E6%9C%BA/">
                        <span class="chip bg-color">装机</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <a href="/about" target="_blank">qwq小小舒</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/js6288" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:linjingshu6288@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1279897306" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1279897306" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
