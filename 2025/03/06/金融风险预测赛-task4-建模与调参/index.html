<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="金融风险预测赛 task4 建模与调参, 小小舒的爪哇天地">
    <meta name="description" content="金融风险预测赛-task4-建模与调参
比赛地址：https://tianchi.aliyun.com/competition/entrance/531830/introduction

1 模型对比与性能评估逻辑回归
优点
训练速度较快，">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>金融风险预测赛 task4 建模与调参 | 小小舒的爪哇天地</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">小小舒的爪哇天地</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">小小舒的爪哇天地</div>
        <div class="logo-desc">
            
            Life is coding, I will debug it.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">金融风险预测赛 task4 建模与调参</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/deep-learning/">
                                <span class="chip bg-color">deep learning</span>
                            </a>
                        
                            <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                <span class="chip bg-color">人工智能</span>
                            </a>
                        
                            <a href="/tags/python/">
                                <span class="chip bg-color">python</span>
                            </a>
                        
                            <a href="/tags/machine-learning/">
                                <span class="chip bg-color">machine learning</span>
                            </a>
                        
                            <a href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/">
                                <span class="chip bg-color">决策树</span>
                            </a>
                        
                            <a href="/tags/pandas/">
                                <span class="chip bg-color">pandas</span>
                            </a>
                        
                            <a href="/tags/numpy/">
                                <span class="chip bg-color">numpy</span>
                            </a>
                        
                            <a href="/tags/LightGBM/">
                                <span class="chip bg-color">LightGBM</span>
                            </a>
                        
                            <a href="/tags/%E8%B0%83%E5%8F%82/">
                                <span class="chip bg-color">调参</span>
                            </a>
                        
                            <a href="/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF%E4%BC%98%E5%8C%96/">
                                <span class="chip bg-color">贝叶斯优化</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/" class="post-category">
                                个人项目
                            </a>
                        
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                机器学习
                            </a>
                        
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="post-category">
                                深度学习
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2025-03-06
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    7.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    32 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="金融风险预测赛-task4-建模与调参"><a href="#金融风险预测赛-task4-建模与调参" class="headerlink" title="金融风险预测赛-task4-建模与调参"></a>金融风险预测赛-task4-建模与调参</h1><blockquote>
<p>比赛地址：<a target="_blank" rel="noopener" href="https://tianchi.aliyun.com/competition/entrance/531830/introduction">https://tianchi.aliyun.com/competition/entrance/531830/introduction</a></p>
</blockquote>
<h2 id="1-模型对比与性能评估"><a href="#1-模型对比与性能评估" class="headerlink" title="1 模型对比与性能评估"></a>1 模型对比与性能评估</h2><h3 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h3><ul>
<li>优点<ul>
<li>训练速度较快，分类的时候，计算量仅仅只和特征的数目相关；</li>
<li>简单易理解，模型的可解释性非常好，从特征的权重可以看到不同的特征对最后结果的影响；</li>
<li>适合二分类问题，不需要缩放输入特征；</li>
<li>内存资源占用小，只需要存储各个维度的特征值；</li>
</ul>
</li>
<li>缺点<ul>
<li><strong>逻辑回归需要预先处理缺失值和异常值【可参考task3特征工程】；</strong></li>
<li>不能用Logistic回归去解决非线性问题，因为Logistic的决策面是线性的；</li>
<li>对多重共线性数据较为敏感，且很难处理数据不平衡的问题；</li>
<li>准确率并不是很高，因为形式非常简单，很难去拟合数据的真实分布；</li>
</ul>
</li>
</ul>
<h3 id="决策树模型"><a href="#决策树模型" class="headerlink" title="决策树模型"></a>决策树模型</h3><ul>
<li>优点<ul>
<li>简单直观，生成的决策树可以可视化展示</li>
<li><strong>数据不需要预处理，不需要归一化，不需要处理缺失数据</strong></li>
<li>既可以处理离散值，也可以处理连续值</li>
</ul>
</li>
<li>缺点<ul>
<li>决策树算法非常容易过拟合，导致泛化能力不强（可进行适当的剪枝）</li>
<li>采用的是贪心算法，容易得到局部最优解</li>
</ul>
</li>
</ul>
<h3 id="集成模型学习方法"><a href="#集成模型学习方法" class="headerlink" title="集成模型学习方法"></a>集成模型学习方法</h3><p>通过组合多个学习器来完成学习任务，通过集成方法，可以将多个弱学习器组合成一个强分类器，因此集成学习的泛化能力一般比单一分类器要好。</p>
<p>集成方法主要包括Bagging和Boosting，Bagging和Boosting都是将已有的分类或回归算法通过一定方式组合起来，形成一个更加强大的分类。两种方法都是把若干个分类器整合为一个分类器的方法，只是整合的方式不一样，最终得到不一样的效果。常见的基于Baggin思想的集成模型有：随机森林、基于Boosting思想的集成模型有：Adaboost、GBDT、XgBoost、LightGBM等。</p>
<p><strong>Baggin和Boosting的区别总结如下：</strong></p>
<ul>
<li><strong>样本选择上：</strong> Bagging方法的训练集是从原始集中有放回的选取，所以从原始集中选出的各轮训练集之间是独立的；而Boosting方法需要每一轮的训练集不变，只是训练集中每个样本在分类器中的权重发生变化。而权值是根据上一轮的分类结果进行调整</li>
<li><strong>样例权重上：</strong> Bagging方法使用均匀取样，所以每个样本的权重相等；而Boosting方法根据错误率不断调整样本的权值，错误率越大则权重越大</li>
<li><strong>预测函数上：</strong> Bagging方法中所有预测函数的权重相等；而Boosting方法中每个弱分类器都有相应的权重，对于分类误差小的分类器会有更大的权重</li>
<li><strong>并行计算上：</strong> Bagging方法中各个预测函数可以并行生成；而Boosting方法各个预测函数只能顺序生成，因为后一个模型参数需要前一轮模型的结果。</li>
</ul>
<h3 id="模型评估方法"><a href="#模型评估方法" class="headerlink" title="模型评估方法"></a>模型评估方法</h3><blockquote>
<p>可看吴恩达机器学习Course2 week3 <a href="https://js6288.github.io/2025/02/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%90%B4%E6%81%A9%E8%BE%BEcourse2week3/">https://js6288.github.io/2025/02/09/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%90%B4%E6%81%A9%E8%BE%BEcourse2week3/</a></p>
</blockquote>
<p>对于模型来说，其在训练集上面的误差我们称之为<strong>训练误差</strong>或者<strong>经验误差</strong>，而在测试集上的误差称之为<strong>测试误差</strong>。</p>
<p>对于我们来说，我们更关心的是模型对于新样本的学习能力，即我们希望通过对已有样本的学习，尽可能的将所有潜在样本的普遍规律学到手，而如果模型对训练样本学的太好，则有可能把训练样本自身所具有的一些特点当做所有潜在样本的普遍特点，这时候我们就会出现<strong>过拟合</strong>的问题。</p>
<p>因此我们通常将已有的数据集划分为训练集和测试集两部分，其中训练集用来训练模型，而测试集则是用来评估模型对于新样本的判别能力。</p>
<p><strong>对于数据集的划分，我们通常要保证满足以下两个条件：</strong></p>
<ul>
<li>训练集和测试集的分布要与样本真实分布一致，即训练集和测试集都要保证是从样本真实分布中独立同分布采样而得；</li>
<li>训练集和测试集要互斥</li>
</ul>
<p><strong>对于数据集的划分有三种方法：留出法，交叉验证法和自助法，下面挨个介绍：</strong></p>
<ul>
<li><p><strong>①留出法</strong></p>
<p>留出法是直接将数据集D划分为两个互斥的集合，其中一个集合作为训练集S，另一个作为测试集T。需要注意的是在划分的时候要尽可能保证数据分布的一致性，即避免因数据划分过程引入额外的偏差而对最终结果产生影响。为了保证数据分布的一致性，通常我们采用<strong>分层采样</strong>的方式来对数据进行采样。</p>
<p><strong>Tips：</strong> 通常，会将数据集D中大约2/3~4/5的样本作为训练集，其余的作为测试集。</p>
</li>
<li><p><strong>②交叉验证法</strong></p>
<p><strong>k折交叉验证</strong>通常将数据集D分为<strong>k份</strong>，其中k-1份作为<strong>训练集</strong>，剩余的一份作为<strong>测试集</strong>，这样就可以获得k组训练/测试集，可以进行k次训练与测试，最终返回的是k个测试结果的均值。交叉验证中数据集的划分依然是依据<strong>分层采样</strong>的方式来进行。</p>
<p>对于交叉验证法，其k值的选取往往决定了评估结果的稳定性和保真性，<strong>通常k值选取10。</strong></p>
<p>将数据集中的<strong>每一个样本</strong>单独作为验证集，其余所有样本作为训练集。换句话说，K等于数据集中的样本数N。**(留一法)**留一法是一种极端形式的K折交叉验证，它最大限度地利用了数据，但同时也带来了较高的计算成本和时间开销。因此，它通常适用于样本量较小的数据集或对计算资源要求不高的场景。</p>
<blockquote>
<p>假设我们有一个数据集，并选择K=5：</p>
<ol>
<li><strong>数据划分</strong>：将数据集随机分成5个子集（折）。</li>
<li>循环训练与验证：<ul>
<li>第一次：使用第1个子集作为验证集，剩余4个子集作为训练集。</li>
<li>第二次：使用第2个子集作为验证集，剩余4个子集作为训练集。</li>
<li>依此类推，直到所有子集都作为验证集使用过一次。</li>
</ul>
</li>
<li><strong>结果汇总</strong>：计算5次验证结果的平均值和标准差。</li>
</ol>
</blockquote>
</li>
<li><p><strong>③自助法</strong></p>
<p>我们每次从数据集D中取一个样本作为训练集中的元素，然后把该样本放回，重复该行为m次，这样我们就可以得到大小为m的训练集，在这里面有的样本重复出现，有的样本则没有出现过，我们把那些没有出现过的样本作为测试集。</p>
<p>进行这样采样的原因是因为在D中约有36.8%的数据没有在训练集中出现过。留出法与交叉验证法都是使用<strong>分层采样</strong>的方式进行数据采样与划分，而自助法则是使用<strong>有放回重复采样</strong>的方式进行数据采样</p>
</li>
</ul>
<p><strong>数据集划分总结</strong></p>
<ul>
<li>对于数据量充足的时候，通常采用<strong>留出法</strong>或者<strong>k折交叉验证法</strong>来进行训练/测试集的划分；</li>
<li>对于数据集小且难以有效划分训练/测试集时使用<strong>自助法</strong>；</li>
<li>对于数据集小且可有效划分的时候最好使用<strong>留一法</strong>来进行划分，因为这种方法最为准确</li>
</ul>
<h3 id="模型评价标准"><a href="#模型评价标准" class="headerlink" title="模型评价标准"></a>模型评价标准</h3><p>对于本次比赛，我们选用auc作为模型评价标准，类似的评价标准还有ks、f1-score等，具体介绍与实现大家可以回顾下task1中的内容。</p>
<p><strong>一起来看一下auc到底是什么？</strong></p>
<p>在逻辑回归里面，对于正负例的界定，通常会设一个阈值，大于阈值的为正类，小于阈值为负类。如果我们减小这个阀值，更多的样本会被识别为正类，提高正类的识别率，但同时也会使得更多的负类被错误识别为正类。为了直观表示这一现象，引入ROC。</p>
<p>根据分类结果计算得到ROC空间中相应的点，连接这些点就形成ROC curve，横坐标为False Positive Rate(FPR：假正率)，纵坐标为True Positive Rate(TPR：真正率)。 一般情况下，这个曲线都应该处于(0,0)和(1,1)连线的上方,如图：</p>
<p><img src="http://img-md-js.linjsblog.top/img/202503042225034.png"></p>
<p><strong>TPR</strong>：在所有实际为正例的样本中，被正确地判断为正例之比率<br>$$<br>TPR= \frac{TP}{TP+FN}<br>$$<br><strong>FPR</strong>：在所有实际为负例的样本中，被错误地判断为正例之比率。<br>$$<br>FPR = \frac{FP}{FP+TN}<br>$$<br>ROC曲线中的四个点：</p>
<ul>
<li>点(0,1)：即FPR=0, TPR=1，意味着FN＝0且FP＝0，将所有的样本都正确分类；</li>
<li>点(1,0)：即FPR=1，TPR=0，最差分类器，避开了所有正确答案；</li>
<li>点(0,0)：即FPR=TPR=0，FP＝TP＝0，分类器把每个实例都预测为负类；</li>
<li>点(1,1)：分类器把每个实例都预测为正类</li>
</ul>
<p><strong>总之：ROC曲线越接近左上角，该分类器的性能越好，其泛化性能就越好。而且一般来说，如果ROC是光滑的，那么基本可以判断没有太大的overfitting。</strong></p>
<p><strong>但是对于两个模型，我们如何判断哪个模型的泛化性能更优呢？这里我们有主要以下两种方法：</strong></p>
<p>如果模型A的ROC曲线完全包住了模型B的ROC曲线，那么我们就认为模型A要优于模型B；</p>
<p>如果两条曲线有交叉的话，我们就通过比较ROC与X，Y轴所围得曲线的面积来判断，面积越大，模型的性能就越优，<strong>这个面积我们称之为AUC(area under ROC curve)</strong></p>
<h2 id="2-代码"><a href="#2-代码" class="headerlink" title="2 代码"></a>2 代码</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> warnings
<span class="token keyword">import</span> os
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token triple-quoted-string string">"""
sns 相关设置
@return:
"""</span>
<span class="token comment"># 声明使用 Seaborn 样式</span>
sns<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 有五种seaborn的绘图风格，它们分别是：darkgrid, whitegrid, dark, white, ticks。默认的主题是darkgrid。</span>
sns<span class="token punctuation">.</span>set_style<span class="token punctuation">(</span><span class="token string">"whitegrid"</span><span class="token punctuation">)</span>
<span class="token comment"># 有四个预置的环境，按大小从小到大排列分别为：paper, notebook, talk, poster。其中，notebook是默认的。</span>
sns<span class="token punctuation">.</span>set_context<span class="token punctuation">(</span><span class="token string">'talk'</span><span class="token punctuation">)</span>
<span class="token comment"># 中文字体设置-黑体</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
<span class="token comment"># 解决保存图像是负号'-'显示为方块的问题</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 解决Seaborn中文显示问题并调整字体大小</span>
sns<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>font<span class="token operator">=</span><span class="token string">'SimHei'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>reduce_mem_usage 函数通过调整数据类型，帮助我们减少数据在内存中占用的空间</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">reduce_mem_usage</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start_mem <span class="token operator">=</span> df<span class="token punctuation">.</span>memory_usage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为MB</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Memory usage of dataframe is {:.2f} MB'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>start_mem<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> col <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
        col_type <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>dtype

        <span class="token keyword">if</span> col_type <span class="token operator">!=</span> <span class="token builtin">object</span><span class="token punctuation">:</span>
            c_min <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            c_max <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>col_type<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'int'</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int8<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int8<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int8<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int16<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int16<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int16<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>iinfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>finfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float16<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>finfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float16<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float16<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> c_min <span class="token operator">&gt;</span> np<span class="token punctuation">.</span>finfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span> <span class="token keyword">and</span> c_max <span class="token operator">&lt;</span> np<span class="token punctuation">.</span>finfo<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            df<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>

    end_mem <span class="token operator">=</span> df<span class="token punctuation">.</span>memory_usage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为MB</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Memory usage after optimization is: {:.2f} MB'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>end_mem<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Decreased by {:.1f}%'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token punctuation">(</span>start_mem <span class="token operator">-</span> end_mem<span class="token punctuation">)</span> <span class="token operator">/</span> start_mem<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> df<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> utils_jessie <span class="token keyword">import</span> reduce_mem_usage
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'user_data/data_for_model.csv'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> reduce_mem_usage<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="简单建模"><a href="#简单建模" class="headerlink" title="简单建模"></a>简单建模</h3><blockquote>
<p>Tips1：金融风控的实际项目多涉及到信用评分，因此需要模型特征具有较好的可解释性，所以目前在实际项目中多还是以逻辑回归作为基础模型。但是在比赛中以得分高低为准，不需要严谨的可解释性，所以大多基于集成算法进行建模。</p>
<p>Tips2：因为逻辑回归的算法特性，需要提前对异常值、缺失值数据进行处理【参考task3部分】</p>
<p>Tips3：基于树模型的算法特性，异常值、缺失值处理可以跳过，但是对于业务较为了解的同学也可以自己对缺失异常值进行处理，效果可能会更优于模型处理的结果。</p>
<p>注：以下建模的源数据参考baseline进行了相应的特征工程，对于异常缺失值未进行相应的处理操作。</p>
</blockquote>
<p>建模之前的预操作</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token comment"># 分离数据集</span>
features <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> data<span class="token punctuation">.</span>columns <span class="token keyword">if</span> f <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'issueDate'</span><span class="token punctuation">,</span><span class="token string">'isDefault'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

train <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>isDefault<span class="token punctuation">.</span>notnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>isDefault<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

X_train <span class="token operator">=</span> train<span class="token punctuation">[</span>features<span class="token punctuation">]</span>
X_test <span class="token operator">=</span> test<span class="token punctuation">[</span>features<span class="token punctuation">]</span>

y_train <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">'isDefault'</span><span class="token punctuation">]</span>

<span class="token comment"># 5折交叉验证</span>
folds <span class="token operator">=</span> <span class="token number">5</span>
seed <span class="token operator">=</span> <span class="token number">2020</span>
kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span>folds<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>seed<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""对训练集数据进行划分，分成训练集和验证集，并进行相应的操作"""</span>


<span class="token comment"># 数据集划分</span>
X_train_split<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_train_split<span class="token punctuation">,</span> y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
train_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_train_split<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train_split<span class="token punctuation">)</span>
valid_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> label<span class="token operator">=</span>y_val<span class="token punctuation">)</span>

params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
            <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
            <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
            <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
            <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">1e-3</span><span class="token punctuation">,</span>
            <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
            <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
            <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token triple-quoted-string string">"""使用训练集数据进行模型训练"""</span>
model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span>train_set<span class="token operator">=</span>train_matrix<span class="token punctuation">,</span> valid_sets<span class="token operator">=</span>valid_matrix<span class="token punctuation">,</span>num_boost_round<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span>callbacks<span class="token operator">=</span><span class="token punctuation">[</span>lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span>stopping_rounds<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>out</strong></p>
<pre class="line-numbers language-none"><code class="language-none">Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[538]	valid_0's auc: 0.726989<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>对验证集进行预测</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_auc_score

<span class="token triple-quoted-string string">"""预测并计算roc的相关指标"""</span>
val_pre_lgb <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>model<span class="token punctuation">.</span>best_iteration<span class="token punctuation">)</span>
fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> threshold <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_curve<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> val_pre_lgb<span class="token punctuation">)</span>
roc_auc <span class="token operator">=</span> metrics<span class="token punctuation">.</span>auc<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'未调参前lightgbm单模型在验证集上的AUC：{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>roc_auc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""画出roc曲线图"""</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Validation ROC'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Val AUC = %0.4f'</span> <span class="token operator">%</span> roc_auc<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'ROC'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate'</span><span class="token punctuation">)</span>
<span class="token comment"># 画出对角线</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'r--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>未调参前lightgbm单模型在验证集上的AUC：0.7269890160490498</p>
<p><img src="http://img-md-js.linjsblog.top/img/202503052352736.png" alt="image-20250305234739384"></p>
<pre class="line-numbers language-none"><code class="language-none">更进一步的，使用5折交叉验证进行模型性能评估<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">cv_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> valid_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'************************************ {} ************************************'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X_train_split<span class="token punctuation">,</span> y_train_split<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val <span class="token operator">=</span> X_train<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>valid_index<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span>valid_index<span class="token punctuation">]</span>

    train_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_train_split<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train_split<span class="token punctuation">)</span>
    valid_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> label<span class="token operator">=</span>y_val<span class="token punctuation">)</span>

    params <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
                <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
                <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
                <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">1e-3</span><span class="token punctuation">,</span>
                <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
                <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">2025</span><span class="token punctuation">,</span>
                <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span> train_set<span class="token operator">=</span>train_matrix<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span> valid_sets<span class="token operator">=</span>valid_matrix<span class="token punctuation">,</span> callbacks<span class="token operator">=</span><span class="token punctuation">[</span>lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span>stopping_rounds<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    val_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>model<span class="token punctuation">.</span>best_iteration<span class="token punctuation">)</span>

    cv_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>roc_auc_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> val_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_scotrainre_list:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_score_mean:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_score_std:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">************************************ 1 ************************************
Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[460]	valid_0's auc: 0.729694
[0.7296937413945397]
************************************ 2 ************************************
Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[635]	valid_0's auc: 0.72572
[0.7296937413945397, 0.7257197647196477]
************************************ 3 ************************************
Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[469]	valid_0's auc: 0.730235
[0.7296937413945397, 0.7257197647196477, 0.7302346168205991]
************************************ 4 ************************************
Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[622]	valid_0's auc: 0.728993
[0.7296937413945397, 0.7257197647196477, 0.7302346168205991, 0.7289925687952793]
************************************ 5 ************************************
Training until validation scores don't improve for 200 rounds
Early stopping, best iteration is:
[746]	valid_0's auc: 0.728447
[0.7296937413945397, 0.7257197647196477, 0.7302346168205991, 0.7289925687952793, 0.7284465494481975]
lgb_scotrainre_list:[0.7296937413945397, 0.7257197647196477, 0.7302346168205991, 0.7289925687952793, 0.7284465494481975]
lgb_score_mean:0.7286174482356527
lgb_score_std:0.001570995403223042<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="3-模型调参"><a href="#3-模型调参" class="headerlink" title="3 模型调参"></a>3 模型调参</h2><h3 id="贪心调参"><a href="#贪心调参" class="headerlink" title="贪心调参"></a>贪心调参</h3><p>先使用当前对模型影响最大的参数进行调优，达到当前参数下的模型最优化，再使用对模型影响次之的参数进行调优，如此下去，直到所有的参数调整完毕。<br>这个方法的缺点就是可能会调到局部最优而不是全局最优，但是只需要一步一步的进行参数最优化调试即可，容易理解。<br>需要注意的是在树模型中参数调整的顺序，也就是各个参数对模型的影响程度，这里列举一下日常调参过程中常用的参数和调参顺序： </p>
<ul>
<li>①：max_depth、num_leaves</li>
<li>②：min_data_in_leaf、min_child_weight</li>
<li>③：bagging_fraction、 feature_fraction、bagging_freq</li>
<li>④：reg_lambda、reg_alpha</li>
<li>⑤：min_split_gain</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">from</span> lightgbm <span class="token keyword">import</span> LGBMClassifier  <span class="token comment"># 使用LGBMClassifier而不是LGBMRegressor，因为我们要计算ROC AUC</span>

<span class="token comment"># 假设X_train, y_train已经加载并预处理好了</span>
<span class="token comment"># X_train, y_train = ...</span>

<span class="token comment"># 定义要测试的目标函数（objective）</span>
objectives <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'binary'</span><span class="token punctuation">,</span> <span class="token string">'cross_entropy'</span><span class="token punctuation">]</span>

<span class="token comment"># 定义要测试的num_leaves值</span>
num_leaves_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span>

<span class="token comment"># 定义要测试的max_depth值</span>
max_depth_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>

<span class="token comment"># 调整目标函数</span>
best_obj <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> obj <span class="token keyword">in</span> objectives<span class="token punctuation">:</span>
    model <span class="token operator">=</span> LGBMClassifier<span class="token punctuation">(</span>objective<span class="token operator">=</span>obj<span class="token punctuation">)</span>
    score <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    best_obj<span class="token punctuation">[</span>obj<span class="token punctuation">]</span> <span class="token operator">=</span> score
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Objective: </span><span class="token interpolation"><span class="token punctuation">{</span>obj<span class="token punctuation">}</span></span><span class="token string">, ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>score<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 获取最佳目标函数</span>
best_objective <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>best_obj<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best Objective: </span><span class="token interpolation"><span class="token punctuation">{</span>best_objective<span class="token punctuation">}</span></span><span class="token string"> with ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>best_obj<span class="token punctuation">[</span>best_objective<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 调整num_leaves</span>
best_leaves <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> leaves <span class="token keyword">in</span> num_leaves_values<span class="token punctuation">:</span>
    model <span class="token operator">=</span> LGBMClassifier<span class="token punctuation">(</span>objective<span class="token operator">=</span>best_objective<span class="token punctuation">,</span> num_leaves<span class="token operator">=</span>leaves<span class="token punctuation">)</span>
    score <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    best_leaves<span class="token punctuation">[</span>leaves<span class="token punctuation">]</span> <span class="token operator">=</span> score
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Num Leaves: </span><span class="token interpolation"><span class="token punctuation">{</span>leaves<span class="token punctuation">}</span></span><span class="token string">, ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>score<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 获取最佳num_leaves</span>
best_num_leaves <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>best_leaves<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best Num Leaves: </span><span class="token interpolation"><span class="token punctuation">{</span>best_num_leaves<span class="token punctuation">}</span></span><span class="token string"> with ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>best_leaves<span class="token punctuation">[</span>best_num_leaves<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 调整max_depth</span>
best_depth <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> depth <span class="token keyword">in</span> max_depth_values<span class="token punctuation">:</span>
    model <span class="token operator">=</span> LGBMClassifier<span class="token punctuation">(</span>objective<span class="token operator">=</span>best_objective<span class="token punctuation">,</span> num_leaves<span class="token operator">=</span>best_num_leaves<span class="token punctuation">,</span> max_depth<span class="token operator">=</span>depth<span class="token punctuation">)</span>
    score <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    best_depth<span class="token punctuation">[</span>depth<span class="token punctuation">]</span> <span class="token operator">=</span> score
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Max Depth: </span><span class="token interpolation"><span class="token punctuation">{</span>depth<span class="token punctuation">}</span></span><span class="token string">, ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>score<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 获取最佳max_depth</span>
best_max_depth <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>best_depth<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Best Max Depth: </span><span class="token interpolation"><span class="token punctuation">{</span>best_max_depth<span class="token punctuation">}</span></span><span class="token string"> with ROC AUC Score: </span><span class="token interpolation"><span class="token punctuation">{</span>best_depth<span class="token punctuation">[</span>best_max_depth<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
可视化部分可以使用matplotlib来绘制每个参数的最佳得分情况
"""</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 绘制不同目标函数的ROC AUC分数</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>best_obj<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> best_obj<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'skyblue'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Objective Function vs ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Objective Function'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制不同num_leaves的ROC AUC分数</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>best_leaves<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>best_leaves<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Num Leaves vs ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Num Leaves'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制不同max_depth的ROC AUC分数</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>best_depth<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>best_depth<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Max Depth vs ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Max Depth'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'ROC AUC Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="http://img-md-js.linjsblog.top/img/202503060037466.png" alt="image-20250306003737380"></p>
<p><img src="http://img-md-js.linjsblog.top/img/202503060037363.png" alt="image-20250306003749272"></p>
<h3 id="网格搜索"><a href="#网格搜索" class="headerlink" title="网格搜索"></a>网格搜索</h3><p>sklearn 提供GridSearchCV用于进行网格搜索，只需要把模型的参数输进去，就能给出最优化的结果和参数。相比起贪心调参，网格搜索的结果会更优，但是网格搜索只适合于小数据集，一旦数据的量级上去了，很难得出结果。</p>
<p>同样以Lightgbm算法为例，进行网格搜索调参：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> StratifiedKFold

<span class="token triple-quoted-string string">"""通过网格搜索确定最优参数"""</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV

<span class="token keyword">def</span> <span class="token function">get_best_cv_params</span><span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">581</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token number">31</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> bagging_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>
                       feature_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>
                       min_split_gain<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置5折交叉验证</span>
    cv_fold <span class="token operator">=</span> StratifiedKFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>

    model_lgb <span class="token operator">=</span> lgb<span class="token punctuation">.</span>LGBMClassifier<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span>
                                   n_estimators<span class="token operator">=</span>n_estimators<span class="token punctuation">,</span>
                                   num_leaves<span class="token operator">=</span>num_leaves<span class="token punctuation">,</span>
                                   max_depth<span class="token operator">=</span>max_depth<span class="token punctuation">,</span>
                                   bagging_fraction<span class="token operator">=</span>bagging_fraction<span class="token punctuation">,</span>
                                   feature_fraction<span class="token operator">=</span>feature_fraction<span class="token punctuation">,</span>
                                   bagging_freq<span class="token operator">=</span>bagging_freq<span class="token punctuation">,</span>
                                   min_data_in_leaf<span class="token operator">=</span>min_data_in_leaf<span class="token punctuation">,</span>
                                   min_child_weight<span class="token operator">=</span>min_child_weight<span class="token punctuation">,</span>
                                   min_split_gain<span class="token operator">=</span>min_split_gain<span class="token punctuation">,</span>
                                   reg_lambda<span class="token operator">=</span>reg_lambda<span class="token punctuation">,</span>
                                   reg_alpha<span class="token operator">=</span>reg_alpha<span class="token punctuation">,</span>
                                   n_jobs<span class="token operator">=</span> <span class="token number">8</span>
                                  <span class="token punctuation">)</span>
    grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>model_lgb<span class="token punctuation">,</span>
                               cv<span class="token operator">=</span>cv_fold<span class="token punctuation">,</span>
                               param_grid<span class="token operator">=</span>param_grid<span class="token punctuation">,</span>
                               scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span>
                              <span class="token punctuation">)</span>
    grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型当前最优参数为:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'模型当前最优得分为:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""以下代码未运行，耗时较长，请谨慎运行，且每一步的最优参数需要在下一步进行手动更新，请注意"""</span>

<span class="token triple-quoted-string string">"""
需要注意一下的是，除了获取上面的获取num_boost_round时候用的是原生的lightgbm（因为要用自带的cv）
下面配合GridSearchCV时必须使用sklearn接口的lightgbm。
"""</span>
<span class="token triple-quoted-string string">"""设置n_estimators 为581，调整num_leaves和max_depth，这里选择先粗调再细调"""</span>
lgb_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
get_best_cv_params<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">581</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
                   min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>bagging_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> feature_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                   min_split_gain<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""num_leaves为30，max_depth为7，进一步细调num_leaves和max_depth"""</span>
lgb_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
get_best_cv_params<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">85</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
                   min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>bagging_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> feature_fraction<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                   min_split_gain<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
确定min_data_in_leaf为45，min_child_weight为0.001 ，下面进行bagging_fraction、feature_fraction和bagging_freq的调参
"""</span>
lgb_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i<span class="token operator">/</span><span class="token number">10</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i<span class="token operator">/</span><span class="token number">10</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
             <span class="token punctuation">}</span>
get_best_cv_params<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">85</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span>
                   min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>bagging_fraction<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> feature_fraction<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                   min_split_gain<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
确定bagging_fraction为0.4、feature_fraction为0.6、bagging_freq为 ，下面进行reg_lambda、reg_alpha的调参
"""</span>
lgb_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0.08</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0.08</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
get_best_cv_params<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">85</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span>
                   min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>bagging_fraction<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> feature_fraction<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>
                   min_split_gain<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
确定reg_lambda、reg_alpha都为0，下面进行min_split_gain的调参
"""</span>
lgb_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'min_split_gain'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i<span class="token operator">/</span><span class="token number">10</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
get_best_cv_params<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">85</span><span class="token punctuation">,</span> num_leaves<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span>
                   min_child_weight<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>bagging_fraction<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> feature_fraction<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> bagging_freq<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>
                   min_split_gain<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> param_grid<span class="token operator">=</span>lgb_params<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">"""
参数确定好了以后，我们设置一个比较小的learning_rate 0.005，来确定最终的num_boost_round
"""
# 设置5折交叉验证
# cv_fold = StratifiedKFold(n_splits=5, random_state=0, shuffle=True, )
final_params = {
                'boosting_type': 'gbdt',
                'learning_rate': 0.01,
                'num_leaves': 29,
                'max_depth': 7,
                'min_data_in_leaf':45,
                'min_child_weight':0.001,
                'bagging_fraction': 0.9,
                'feature_fraction': 0.9,
                'bagging_freq': 40,
                'min_split_gain': 0,
                'reg_lambda':0,
                'reg_alpha':0,
                'nthread': 6
               }

cv_result = lgb.cv(train_set=lgb_train,
                   early_stopping_rounds=20,
                   num_boost_round=5000,
                   nfold=5,
                   stratified=True,
                   shuffle=True,
                   params=final_params,
                   metrics='auc',
                   seed=0,
                  )

print('迭代次数{}'.format(len(cv_result['auc-mean'])))
print('交叉验证的AUC为{}'.format(max(cv_result['auc-mean'])))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在实际调整过程中，可先设置一个较大的学习率（上面的例子中0.1），通过Lgb原生的cv函数进行树个数的确定，之后再通过上面的实例代码进行参数的调整优化。</p>
<p>最后针对最优的参数设置一个较小的学习率（例如0.05），同样通过cv函数确定树的个数，确定最终的参数。</p>
<p>需要注意的是，针对大数据集，上面每一层参数的调整都需要耗费较长时间</p>
<h3 id="贝叶斯调参（重点）"><a href="#贝叶斯调参（重点）" class="headerlink" title="贝叶斯调参（重点）"></a>贝叶斯调参（重点）</h3><p>在使用之前需要先安装包bayesian-optimization，运行如下命令即可：</p>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">pip install bayesian-optimization<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>贝叶斯调参的主要思想是：给定优化的目标函数(广义的函数，只需指定输入和输出即可，无需知道内部结构以及数学性质)，通过不断地添加样本点来更新目标函数的后验分布(高斯过程,直到后验分布基本贴合于真实分布）。简单的说，就是考虑了上一次参数的信息，从而更好的调整当前的参数。</p>
<p>贝叶斯调参的步骤如下：</p>
<ul>
<li>定义优化函数(rf_cv）</li>
<li>建立模型</li>
<li>定义待优化的参数</li>
<li>得到优化结果，并返回要优化的分数指标</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score

<span class="token triple-quoted-string string">"""定义优化函数"""</span>


<span class="token keyword">def</span> <span class="token function">rf_cv_lgb</span><span class="token punctuation">(</span>num_leaves<span class="token punctuation">,</span> max_depth<span class="token punctuation">,</span> bagging_fraction<span class="token punctuation">,</span> feature_fraction<span class="token punctuation">,</span> bagging_freq<span class="token punctuation">,</span> min_data_in_leaf<span class="token punctuation">,</span>
              min_child_weight<span class="token punctuation">,</span> min_split_gain<span class="token punctuation">,</span> reg_lambda<span class="token punctuation">,</span> reg_alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 建立模型</span>
    model_lgb <span class="token operator">=</span> lgb<span class="token punctuation">.</span>LGBMClassifier<span class="token punctuation">(</span>boosting_type<span class="token operator">=</span><span class="token string">'gbdt'</span><span class="token punctuation">,</span> bjective<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'auc'</span><span class="token punctuation">,</span>
                                   learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span>
                                   num_leaves<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>num_leaves<span class="token punctuation">)</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>max_depth<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   bagging_fraction<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>bagging_fraction<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   feature_fraction<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>feature_fraction<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   bagging_freq<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>bagging_freq<span class="token punctuation">)</span><span class="token punctuation">,</span> min_data_in_leaf<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>min_data_in_leaf<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   min_child_weight<span class="token operator">=</span>min_child_weight<span class="token punctuation">,</span> min_split_gain<span class="token operator">=</span>min_split_gain<span class="token punctuation">,</span>
                                   reg_lambda<span class="token operator">=</span>reg_lambda<span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span>reg_alpha<span class="token punctuation">,</span>
                                   n_jobs<span class="token operator">=</span><span class="token number">8</span>
                                   <span class="token punctuation">)</span>

    val <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>model_lgb<span class="token punctuation">,</span> X_train_split<span class="token punctuation">,</span> y_train_split<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'roc_auc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> val<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bayes_opt <span class="token keyword">import</span> BayesianOptimization
<span class="token triple-quoted-string string">"""定义优化参数"""</span>
bayes_lgb <span class="token operator">=</span> BayesianOptimization<span class="token punctuation">(</span>
    rf_cv_lgb<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">'num_leaves'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 这是树的最大叶子节点数。LightGBM使用的是基于叶子生长的算法，这意味着它直接控制着每棵树的复杂度。较高的值可能导致过拟合。</span>
        <span class="token string">'max_depth'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 树的最大深度。这个参数用于限制树的生长深度，从而控制模型的复杂度和防止过拟合。注意，num_leaves 和 max_depth 都是用来控制树的大小，但它们之间没有直接的关系（例如，一个深度为5的树可以有少于或超过31个叶子节点）</span>
        <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 每次迭代时用来训练树的数据比例。通过随机选择部分数据来构建树，这种方法可以减少方差，提高模型的稳定性。</span>
        <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 每次迭代时用来训练树的特征比例。类似于bagging_fraction，但它作用于特征而不是样本。这有助于增加模型的多样性，并可能改善模型性能。</span>
        <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#bagging的频率，即每多少次迭代执行一次bagging。如果设置为0，则不使用bagging。</span>
        <span class="token string">'min_data_in_leaf'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 一个叶子上最少需要包含的样本数量。适当增大这个值可以帮助防止过拟合，尤其是在处理大量分类问题时。</span>
        <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 叶子节点上的最小hessian和，或者说是样本权重总和的最小值。与min_data_in_leaf类似，但考虑了样本权重。该参数对于控制过拟合也很重要</span>
        <span class="token string">'min_split_gain'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 节点分裂所需的最小增益。值越大，分裂越严格，可能会导致生成更少的分裂，从而简化模型。</span>
        <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># L1正则化系数。L1正则化能够促使一些不重要的特征对应的权重变为零，因此有利于特征选择。</span>
        <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># L2正则化系数。L2正则化通过惩罚较大的权重值来防止过拟合，促进模型泛化能力。</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""开始优化"""</span>
bayes_lgb<span class="token punctuation">.</span>maximize<span class="token punctuation">(</span>n_iter<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">|   iter    |  target   | baggin... | baggin... | featur... | max_depth | min_ch... | min_da... | min_sp... | num_le... | reg_alpha | reg_la... |
-------------------------------------------------------------------------------------------------------------------------------------------------
| 1         | 0.7271    | 0.9931    | 11.53     | 0.521     | 10.99     | 7.394     | 63.61     | 0.4806    | 77.44     | 5.035     | 0.05619   |
| 2         | 0.7209    | 0.9812    | 50.53     | 0.9439    | 16.37     | 8.388     | 31.72     | 0.5239    | 56.71     | 0.4872    | 0.05511   |
| 3         | 0.7103    | 0.7282    | 56.53     | 0.5157    | 6.974     | 6.398     | 17.57     | 0.1437    | 193.0     | 5.971     | 2.299     |
| 4         | 0.7207    | 0.6776    | 81.37     | 0.7428    | 16.25     | 4.916     | 84.58     | 0.5109    | 33.45     | 3.469     | 5.095     |
| 5         | 0.7258    | 0.763     | 82.57     | 0.9972    | 13.72     | 7.786     | 15.33     | 0.6128    | 101.0     | 4.161     | 5.15      |
| 6         | 0.7265    | 0.9556    | 81.36     | 0.6473    | 13.15     | 5.886     | 17.21     | 0.4262    | 100.2     | 5.213     | 5.8       |
| 7         | 0.7077    | 0.7317    | 53.51     | 0.9043    | 19.48     | 1.668     | 56.33     | 0.1234    | 109.7     | 9.833     | 5.946     |
| 8         | 0.7084    | 0.7631    | 2.874     | 0.5811    | 11.16     | 4.936     | 57.08     | 0.3166    | 54.07     | 4.149     | 0.8002    |
| 9         | 0.7204    | 0.8934    | 9.184     | 0.5191    | 11.4      | 8.275     | 66.96     | 0.3591    | 89.28     | 6.256     | 9.558     |
| 10        | 0.6995    | 0.6747    | 21.95     | 0.7082    | 13.39     | 9.605     | 56.06     | 0.1606    | 82.57     | 1.762     | 0.01093   |
| 11        | 0.7017    | 0.9008    | 4.37      | 0.8852    | 8.091     | 7.599     | 68.99     | 0.1467    | 77.55     | 1.088     | 2.486     |
| 12        | 0.7238    | 0.5586    | 83.59     | 0.7312    | 13.31     | 1.363     | 13.65     | 0.8541    | 101.3     | 1.519     | 7.183     |
| 13        | 0.7275    | 0.8928    | 86.33     | 0.7456    | 13.16     | 4.83      | 14.43     | 0.6161    | 105.6     | 6.13      | 6.228     |
| 14        | 0.7275    | 0.7006    | 82.96     | 0.5886    | 7.2       | 6.598     | 14.67     | 0.4994    | 104.3     | 9.312     | 4.845     |
| 15        | 0.7218    | 0.5751    | 85.7      | 0.5523    | 10.78     | 3.893     | 22.01     | 0.3167    | 106.0     | 6.596     | 3.21      |
=================================================================================================================================================<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""显示优化结果"""</span>
bayes_lgb<span class="token punctuation">.</span><span class="token builtin">max</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">{'target': 0.7275442168806482,
 'params': {'bagging_fraction': 0.7006006252457107,
  'bagging_freq': 82.96446800456837,
  'feature_fraction': 0.5885852105566081,
  'max_depth': 7.199867173297536,
  'min_child_weight': 6.598336034908653,
  'min_data_in_leaf': 14.67034546089463,
  'min_split_gain': 0.49937757419359885,
  'num_leaves': 104.26693332469026,
  'reg_alpha': 9.31177341113749,
  'reg_lambda': 4.845204385655803}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""调整一个较小的学习率，并通过cv函数确定当前最优的迭代次数"""</span>
base_params_lgb<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
    <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
    <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
    <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
    <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
    <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token string">'min_data_in_leaf'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
    <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token number">6.6</span><span class="token punctuation">,</span>
    <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
    <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.58</span><span class="token punctuation">,</span>
    <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
    <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token string">'min_split_gain'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">2025</span><span class="token punctuation">,</span>
    <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

cv_result_lgb <span class="token operator">=</span> lgb<span class="token punctuation">.</span>cv<span class="token punctuation">(</span>
    params<span class="token operator">=</span>base_params_lgb<span class="token punctuation">,</span>
    train_set<span class="token operator">=</span>train_matrix<span class="token punctuation">,</span>
    callbacks<span class="token operator">=</span><span class="token punctuation">[</span>lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    num_boost_round<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span>
    nfold<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    stratified<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    metrics<span class="token operator">=</span><span class="token string">'auc'</span><span class="token punctuation">,</span>
    seed<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'迭代次数{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cv_result_lgb<span class="token punctuation">[</span><span class="token string">'auc-mean'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最终模型的AUC为{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>cv_result_lgb<span class="token punctuation">[</span><span class="token string">'auc-mean'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>迭代次数5971<br>最终模型的AUC为0.7311606929249331</p>
<h3 id="模型参数已经确定，建立最终模型并对验证集进行验证"><a href="#模型参数已经确定，建立最终模型并对验证集进行验证" class="headerlink" title="模型参数已经确定，建立最终模型并对验证集进行验证"></a><strong>模型参数已经确定，建立最终模型并对验证集进行验证</strong></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""使用lightgbm 5折交叉验证进行建模预测"""</span>
cv_scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> valid_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'************************************ {} ************************************'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X_train_split<span class="token punctuation">,</span> y_train_split<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_val <span class="token operator">=</span> X_train<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>valid_index<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span>valid_index<span class="token punctuation">]</span>

    train_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_train_split<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train_split<span class="token punctuation">)</span>
    valid_matrix <span class="token operator">=</span> lgb<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> label<span class="token operator">=</span>y_val<span class="token punctuation">)</span>

    params <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
                <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
                <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
                <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
                <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
                <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
                <span class="token string">'min_data_in_leaf'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
                <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token number">6.6</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
                <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.58</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
                <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
                <span class="token string">'min_split_gain'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">2025</span><span class="token punctuation">,</span>
                <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    model <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span> train_set<span class="token operator">=</span>train_matrix<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">5971</span><span class="token punctuation">,</span> valid_sets<span class="token operator">=</span>valid_matrix<span class="token punctuation">,</span>callbacks<span class="token operator">=</span><span class="token punctuation">[</span>lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    val_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span> num_iteration<span class="token operator">=</span>model<span class="token punctuation">.</span>best_iteration<span class="token punctuation">)</span>

    cv_scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>roc_auc_score<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> val_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_scotrainre_list:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_score_mean:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"lgb_score_std:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>cv_scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>lgb_scotrainre_list:[0.7327504680236936, 0.729543133208145, 0.733500226142979, 0.7326268181775848, 0.731541105300757]<br>lgb_score_mean:0.7319923501706319<br>lgb_score_std:0.001375010395661169</p>
<h3 id="最终训练"><a href="#最终训练" class="headerlink" title="最终训练"></a>最终训练</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">base_params_lgb <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'boosting_type'</span><span class="token punctuation">:</span> <span class="token string">'gbdt'</span><span class="token punctuation">,</span>
                <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'binary'</span><span class="token punctuation">,</span>
                <span class="token string">'metric'</span><span class="token punctuation">:</span> <span class="token string">'auc'</span><span class="token punctuation">,</span>
                <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span>
                <span class="token string">'num_leaves'</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
                <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
                <span class="token string">'min_data_in_leaf'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
                <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span><span class="token number">6.6</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
                <span class="token string">'feature_fraction'</span><span class="token punctuation">:</span> <span class="token number">0.58</span><span class="token punctuation">,</span>
                <span class="token string">'bagging_freq'</span><span class="token punctuation">:</span> <span class="token number">83</span><span class="token punctuation">,</span>
                <span class="token string">'reg_lambda'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token string">'reg_alpha'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
                <span class="token string">'min_split_gain'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">2025</span><span class="token punctuation">,</span>
                <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

<span class="token triple-quoted-string string">"""使用训练集数据进行模型训练"""</span>
final_model_lgb <span class="token operator">=</span> lgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>base_params_lgb<span class="token punctuation">,</span> train_set<span class="token operator">=</span>train_matrix<span class="token punctuation">,</span> valid_sets<span class="token operator">=</span>valid_matrix<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">5971</span><span class="token punctuation">,</span> callbacks<span class="token operator">=</span><span class="token punctuation">[</span>lgb<span class="token punctuation">.</span>log_evaluation<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lgb<span class="token punctuation">.</span>early_stopping<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""预测并计算roc的相关指标"""</span>
val_pre_lgb <span class="token operator">=</span> final_model_lgb<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>
fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> threshold <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_curve<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span> val_pre_lgb<span class="token punctuation">)</span>
roc_auc <span class="token operator">=</span> metrics<span class="token punctuation">.</span>auc<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'调参后lightgbm单模型在验证集上的AUC：{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>roc_auc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""画出roc曲线图"""</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Validation ROC'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Val AUC = %0.4f'</span> <span class="token operator">%</span> roc_auc<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'ROC'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate'</span><span class="token punctuation">)</span>
<span class="token comment"># 画出对角线</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'r--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Training until validation scores don’t improve for 200 rounds<br>[1000]	valid_0’s auc: 0.725299<br>[2000]	valid_0’s auc: 0.728653<br>[3000]	valid_0’s auc: 0.730034<br>[4000]	valid_0’s auc: 0.730817<br>[5000]	valid_0’s auc: 0.731383<br>Early stopping, best iteration is:<br>[5724]	valid_0’s auc: 0.731541<br>调参后lightgbm单模型在验证集上的AUC：0.731541105300757</p>
<p><img src="http://img-md-js.linjsblog.top/img/202503061252407.png" alt="image-20250306125256227"></p>
<p>可以看到相比最早的原始参数，模型的性能还是有提升的</p>
<h3 id="保存模型"><a href="#保存模型" class="headerlink" title="保存模型"></a>保存模型</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""保存模型到本地"""</span>
<span class="token comment"># 保存模型</span>
<span class="token keyword">import</span> pickle
pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>final_model_lgb<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'model/model_lgb_best-2025-0306.pkl'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">qwq小小舒</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://js6288.github.io/2025/03/06/%E9%87%91%E8%9E%8D%E9%A3%8E%E9%99%A9%E9%A2%84%E6%B5%8B%E8%B5%9B-task4-%E5%BB%BA%E6%A8%A1%E4%B8%8E%E8%B0%83%E5%8F%82/">https://js6288.github.io/2025/03/06/%E9%87%91%E8%9E%8D%E9%A3%8E%E9%99%A9%E9%A2%84%E6%B5%8B%E8%B5%9B-task4-%E5%BB%BA%E6%A8%A1%E4%B8%8E%E8%B0%83%E5%8F%82/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">qwq小小舒</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/deep-learning/">
                                    <span class="chip bg-color">deep learning</span>
                                </a>
                            
                                <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                    <span class="chip bg-color">人工智能</span>
                                </a>
                            
                                <a href="/tags/python/">
                                    <span class="chip bg-color">python</span>
                                </a>
                            
                                <a href="/tags/machine-learning/">
                                    <span class="chip bg-color">machine learning</span>
                                </a>
                            
                                <a href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/">
                                    <span class="chip bg-color">决策树</span>
                                </a>
                            
                                <a href="/tags/pandas/">
                                    <span class="chip bg-color">pandas</span>
                                </a>
                            
                                <a href="/tags/numpy/">
                                    <span class="chip bg-color">numpy</span>
                                </a>
                            
                                <a href="/tags/LightGBM/">
                                    <span class="chip bg-color">LightGBM</span>
                                </a>
                            
                                <a href="/tags/%E8%B0%83%E5%8F%82/">
                                    <span class="chip bg-color">调参</span>
                                </a>
                            
                                <a href="/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF%E4%BC%98%E5%8C%96/">
                                    <span class="chip bg-color">贝叶斯优化</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay1.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2025/03/07/%E9%87%91%E8%9E%8D%E9%A3%8E%E9%99%A9%E9%A2%84%E6%B5%8B%E8%B5%9B-task5-%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="金融风险预测赛 task5 模型融合stacking&amp;blending">
                        
                        <span class="card-title">金融风险预测赛 task5 模型融合stacking&amp;blending</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-03-07
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/" class="post-category">
                                    个人项目
                                </a>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                    机器学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/machine-learning/">
                        <span class="chip bg-color">machine learning</span>
                    </a>
                    
                    <a href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/">
                        <span class="chip bg-color">决策树</span>
                    </a>
                    
                    <a href="/tags/pandas/">
                        <span class="chip bg-color">pandas</span>
                    </a>
                    
                    <a href="/tags/numpy/">
                        <span class="chip bg-color">numpy</span>
                    </a>
                    
                    <a href="/tags/LightGBM/">
                        <span class="chip bg-color">LightGBM</span>
                    </a>
                    
                    <a href="/tags/%E8%B0%83%E5%8F%82/">
                        <span class="chip bg-color">调参</span>
                    </a>
                    
                    <a href="/tags/xgboost/">
                        <span class="chip bg-color">xgboost</span>
                    </a>
                    
                    <a href="/tags/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/">
                        <span class="chip bg-color">集成学习</span>
                    </a>
                    
                    <a href="/tags/stacking/">
                        <span class="chip bg-color">stacking</span>
                    </a>
                    
                    <a href="/tags/blending/">
                        <span class="chip bg-color">blending</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/03/03/%E9%87%91%E8%9E%8D%E9%A3%8E%E9%99%A9%E9%A2%84%E6%B5%8B%E8%B5%9B-task3-%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="金融风险预测赛 task3 特征工程">
                        
                        <span class="card-title">金融风险预测赛 task3 特征工程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-03-03
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/" class="post-category">
                                    个人项目
                                </a>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                    机器学习
                                </a>
                            
                            <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="post-category">
                                    深度学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/deep-learning/">
                        <span class="chip bg-color">deep learning</span>
                    </a>
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/machine-learning/">
                        <span class="chip bg-color">machine learning</span>
                    </a>
                    
                    <a href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/">
                        <span class="chip bg-color">决策树</span>
                    </a>
                    
                    <a href="/tags/pandas/">
                        <span class="chip bg-color">pandas</span>
                    </a>
                    
                    <a href="/tags/numpy/">
                        <span class="chip bg-color">numpy</span>
                    </a>
                    
                    <a href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/">
                        <span class="chip bg-color">特征工程</span>
                    </a>
                    
                    <a href="/tags/LightGBM/">
                        <span class="chip bg-color">LightGBM</span>
                    </a>
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">
                        <span class="chip bg-color">数据处理</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        TeX: {
            extensions: ["AMSmath.js", "AMSsymbols.js"] // 手动加载 AMS 扩展
        }
    });
</script>



    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <a href="/about" target="_blank">qwq小小舒</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/js6288" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:linjingshu6288@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1279897306" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1279897306" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
